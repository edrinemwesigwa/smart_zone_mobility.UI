{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/edrin/OneDrive/Desktop/Mobility/SmartZoneSimulator.UI/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { firstValueFrom } from \"rxjs\";\nimport { getApiBase } from \"./api-base\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let TrafficApiService = /*#__PURE__*/(() => {\n  class TrafficApiService {\n    constructor(http) {\n      this.http = http;\n      this.apiUrl = `${getApiBase()}/api/traffic`;\n      this.liveApiEnabled = true;\n    }\n    isLiveAvailable() {\n      return this.liveApiEnabled;\n    }\n    getLiveTraffic(zoneId) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          return yield firstValueFrom(_this.http.get(`${_this.apiUrl}/live/${zoneId}`));\n        } catch {\n          return _this.buildMockTraffic(zoneId);\n        }\n      })();\n    }\n    getHistoricalPattern(zoneId, time) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          return yield firstValueFrom(_this2.http.get(`${_this2.apiUrl}/historical/${zoneId}`, {\n            params: {\n              time: time.toISOString()\n            }\n          }));\n        } catch {\n          return _this2.buildMockHistorical(time);\n        }\n      })();\n    }\n    getIncidents(area) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          return yield firstValueFrom(_this3.http.get(`${_this3.apiUrl}/incidents`, {\n            params: {\n              area\n            }\n          }));\n        } catch {\n          return [];\n        }\n      })();\n    }\n    buildMockTraffic(zoneId) {\n      const segments = this.mockSegments();\n      const avgSpeed = segments.reduce((sum, s) => sum + s.speed, 0) / (segments.length || 1);\n      const congestion = segments.reduce((sum, s) => sum + s.congestionLevel, 0) / (segments.length || 1);\n      return {\n        averageSpeed: Math.round(avgSpeed * 10) / 10,\n        congestionLevel: Math.round(congestion),\n        timestamp: new Date().toISOString(),\n        reliability: 0.7,\n        segments,\n        incidents: this.mockIncidents()\n      };\n    }\n    buildMockHistorical(time) {\n      const hour = time.getHours();\n      const baseSpeed = hour >= 7 && hour <= 9 ? 25 : hour >= 16 && hour <= 19 ? 28 : 55;\n      const congestion = hour >= 7 && hour <= 9 ? 75 : hour >= 16 && hour <= 19 ? 70 : 40;\n      return {\n        points: [],\n        segments: this.mockSegments(baseSpeed),\n        incidents: this.mockIncidents(),\n        baseSpeed,\n        congestionLevel: congestion\n      };\n    }\n    mockSegments(baseSpeed = 40) {\n      const speeds = [baseSpeed - 5, baseSpeed, baseSpeed + 6, baseSpeed - 8];\n      const congestionLevels = [60, 40, 30, 70];\n      const directions = [\"N\", \"S\", \"E\", \"W\"];\n      return speeds.map((speed, index) => ({\n        id: `seg-${index + 1}`,\n        path: [],\n        speed: Math.max(15, speed),\n        congestionLevel: congestionLevels[index] ?? 50,\n        flowDirection: directions[index] ?? \"N\"\n      }));\n    }\n    mockIncidents() {\n      return [{\n        id: \"incident-1\",\n        type: \"Roadworks\",\n        description: \"Lane closure due to maintenance\",\n        severity: \"Medium\",\n        latitude: 25.2048,\n        longitude: 55.2708\n      }, {\n        id: \"incident-2\",\n        type: \"Accident\",\n        description: \"Minor collision, expect delays\",\n        severity: \"Low\",\n        latitude: 24.4539,\n        longitude: 54.3773\n      }];\n    }\n    static {\n      this.ɵfac = function TrafficApiService_Factory(t) {\n        return new (t || TrafficApiService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: TrafficApiService,\n        factory: TrafficApiService.ɵfac,\n        providedIn: \"root\"\n      });\n    }\n  }\n  return TrafficApiService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}