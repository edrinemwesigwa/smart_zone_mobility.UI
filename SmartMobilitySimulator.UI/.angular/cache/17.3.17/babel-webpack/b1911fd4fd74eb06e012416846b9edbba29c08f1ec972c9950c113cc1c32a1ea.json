{"ast":null,"code":"import * as L from \"leaflet\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/zone.service\";\nimport * as i2 from \"../../services/traffic-layer.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction ZoneMapComponent_span_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 21);\n    i0.ɵɵtext(1, \"Live\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ZoneMapComponent_span_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 22);\n    i0.ɵɵtext(1, \"Historical\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ZoneMapComponent_span_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 23);\n    i0.ɵɵtext(1, \"Simulation\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ZoneMapComponent_span_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 24);\n    i0.ɵɵtext(1, \" API key missing \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ZoneMapComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 25)(1, \"div\", 26)(2, \"span\", 4);\n    i0.ɵɵtext(3, \"Time:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"strong\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"input\", 27);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ZoneMapComponent_div_26_Template_input_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.timeIndex, $event) || (ctx_r1.timeIndex = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"input\", function ZoneMapComponent_div_26_Template_input_input_6_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onTimeChange());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function ZoneMapComponent_div_26_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.toggleAnimation());\n    });\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"select\", 29);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ZoneMapComponent_div_26_Template_select_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.animationSpeed, $event) || (ctx_r1.animationSpeed = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function ZoneMapComponent_div_26_Template_select_change_9_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onSpeedChange());\n    });\n    i0.ɵɵelementStart(10, \"option\", 30);\n    i0.ɵɵtext(11, \"Slow\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"option\", 30);\n    i0.ɵɵtext(13, \"Normal\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"option\", 30);\n    i0.ɵɵtext(15, \"Fast\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.formatHour(ctx_r1.timeIndex));\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.timeIndex);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.isAnimating ? \"Pause\" : \"Play\", \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.animationSpeed);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngValue\", 2500);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngValue\", 1500);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngValue\", 800);\n  }\n}\nfunction ZoneMapComponent_div_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31);\n    i0.ɵɵtext(1, \"Loading zones...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ZoneMapComponent_div_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.error);\n  }\n}\nfunction ZoneMapComponent_div_40_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 39);\n    i0.ɵɵlistener(\"click\", function ZoneMapComponent_div_40_div_9_Template_div_click_0_listener() {\n      const zone_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onZoneSelected(zone_r4));\n    });\n    i0.ɵɵelement(1, \"div\", 40);\n    i0.ɵɵelementStart(2, \"div\", 41)(3, \"h5\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"span\", 42);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 43)(8, \"span\", 44);\n    i0.ɵɵtext(9, \"Rate:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"span\", 45);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const zone_r4 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵclassProp(\"selected\", (ctx_r1.selectedZone == null ? null : ctx_r1.selectedZone.id) === zone_r4.id);\n    i0.ɵɵadvance();\n    i0.ɵɵstyleProp(\"background-color\", ctx_r1.getZoneColor(zone_r4.zoneType));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(zone_r4.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(zone_r4.zoneType);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"AED \", zone_r4.chargePerHour, \"/hr\");\n  }\n}\nfunction ZoneMapComponent_div_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33)(1, \"div\", 34)(2, \"span\", 35);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h4\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"span\", 36);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 37);\n    i0.ɵɵtemplate(9, ZoneMapComponent_div_40_div_9_Template, 12, 7, \"div\", 38);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const group_r5 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", group_r5.emirate === \"Dubai\" ? \"\\uD83C\\uDDE6\\uD83C\\uDDEA\" : group_r5.emirate === \"Abu Dhabi\" ? \"\\uD83C\\uDFDB\\uFE0F\" : \"\\uD83D\\uDD4C\", \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(group_r5.emirate);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", group_r5.zones.length, \" zones\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", group_r5.zones);\n  }\n}\nfunction ZoneMapComponent_div_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 46)(1, \"h3\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\")(4, \"strong\");\n    i0.ɵɵtext(5, \"Type:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\")(8, \"strong\");\n    i0.ɵɵtext(9, \"Base Free Hours:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"p\")(12, \"strong\");\n    i0.ɵɵtext(13, \"Charge Per Hour:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r1.selectedZone.name, \" Details\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedZone.zoneType, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedZone.baseFreeHours, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" AED \", ctx_r1.selectedZone.chargePerHour, \"\");\n  }\n}\nexport let ZoneMapComponent = /*#__PURE__*/(() => {\n  class ZoneMapComponent {\n    // Get zones grouped by emirate\n    get zonesByEmirate() {\n      const grouped = this.zones.reduce((acc, zone) => {\n        const emirate = zone.emirate || \"Other\";\n        if (!acc[emirate]) {\n          acc[emirate] = [];\n        }\n        acc[emirate].push(zone);\n        return acc;\n      }, {});\n      return Object.entries(grouped).map(([emirate, zones]) => ({\n        emirate,\n        zones\n      })).sort((a, b) => a.emirate.localeCompare(b.emirate));\n    }\n    constructor(zoneService, trafficLayerService) {\n      this.zoneService = zoneService;\n      this.trafficLayerService = trafficLayerService;\n      this.zones = [];\n      this.selectedZone = null;\n      this.mapCenter = {\n        lat: 24.4539,\n        lng: 54.3773\n      }; // UAE center\n      this.mapZoom = 8;\n      this.timeIndex = new Date().getHours();\n      this.isAnimating = false;\n      this.animationSpeed = 1500;\n      this.isLoading = false;\n      this.error = null;\n      this.trafficMode = \"historical\";\n      this.liveTrafficAvailable = false;\n      this.lastTrafficUpdate = null;\n      this.map = null;\n      this.markerLayer = null;\n      this.polygonLayer = null;\n      this.refreshHandle = null;\n      this.heatmapTimer = null;\n      this.zoneLayers = new Map();\n      this.zoneBounds = new Map();\n    }\n    ngOnInit() {\n      this.loadZones();\n      this.refreshHandle = window.setInterval(() => this.loadZones(false), 15000);\n    }\n    ngAfterViewInit() {\n      this.initializeMap();\n    }\n    ngOnDestroy() {\n      if (this.refreshHandle) {\n        window.clearInterval(this.refreshHandle);\n      }\n      if (this.heatmapTimer) {\n        window.clearInterval(this.heatmapTimer);\n      }\n      this.trafficLayerService.stopLiveUpdates();\n      if (this.map) {\n        this.map.remove();\n      }\n    }\n    loadZones(showLoading = true) {\n      this.isLoading = showLoading;\n      this.zoneService.getAllZones().subscribe({\n        next: zones => {\n          this.zones = zones;\n          this.isLoading = false;\n          this.renderZonePolygons();\n        },\n        error: err => {\n          this.error = \"Failed to load zones\";\n          this.isLoading = false;\n          console.error(err);\n        }\n      });\n    }\n    onZoneSelected(zone) {\n      this.selectedZone = zone;\n      // Center map on selected zone\n      const coords = this.getZoneCoordinates(zone);\n      this.mapCenter = {\n        lat: coords[0],\n        lng: coords[1]\n      };\n      this.mapZoom = 11;\n      if (this.map) {\n        this.map.setView(coords, this.mapZoom);\n      }\n      this.refreshTrafficLayer();\n    }\n    filterByEmirate(emirate) {\n      if (emirate === \"All\") {\n        this.loadZones();\n        this.setMapViewByEmirate(emirate);\n      } else {\n        this.isLoading = true;\n        this.zoneService.getZonesByEmirate(emirate).subscribe({\n          next: zones => {\n            this.zones = zones;\n            this.isLoading = false;\n            this.renderZonePolygons();\n            this.setMapViewByEmirate(emirate);\n          },\n          error: err => {\n            this.error = `Failed to load zones for ${emirate}`;\n            this.isLoading = false;\n          }\n        });\n      }\n    }\n    onTimeChange() {\n      this.updateHeatmapStyles();\n      if (this.trafficMode === \"historical\" && this.selectedZone) {\n        this.showHistoricalTraffic();\n      }\n    }\n    toggleAnimation() {\n      if (this.isAnimating) {\n        this.stopAnimation();\n      } else {\n        this.startAnimation();\n      }\n    }\n    startAnimation() {\n      if (this.heatmapTimer) {\n        window.clearInterval(this.heatmapTimer);\n      }\n      this.isAnimating = true;\n      this.heatmapTimer = window.setInterval(() => {\n        this.timeIndex = (this.timeIndex + 1) % 24;\n        this.updateHeatmapStyles();\n      }, this.animationSpeed);\n    }\n    stopAnimation() {\n      if (this.heatmapTimer) {\n        window.clearInterval(this.heatmapTimer);\n        this.heatmapTimer = null;\n      }\n      this.isAnimating = false;\n    }\n    onSpeedChange() {\n      if (this.isAnimating) {\n        this.startAnimation();\n      }\n    }\n    formatHour(hour) {\n      const normalized = (hour % 24 + 24) % 24;\n      const suffix = normalized >= 12 ? \"PM\" : \"AM\";\n      const display = normalized % 12 === 0 ? 12 : normalized % 12;\n      return `${display}:00 ${suffix}`;\n    }\n    getZoneColor(zoneType) {\n      switch (zoneType) {\n        case \"Residential\":\n          return \"#4CAF50\";\n        case \"Commercial\":\n          return \"#FF9800\";\n        case \"Industrial\":\n          return \"#9C27B0\";\n        case \"Mixed\":\n          return \"#2196F3\";\n        default:\n          return \"#757575\";\n      }\n    }\n    initializeMap() {\n      const defaultIcon = L.icon({\n        iconRetinaUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png\",\n        iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\n        shadowUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\n        iconSize: [25, 41],\n        iconAnchor: [12, 41],\n        popupAnchor: [1, -34],\n        shadowSize: [41, 41]\n      });\n      L.Marker.prototype.options.icon = defaultIcon;\n      this.map = L.map(\"zone-map\", {\n        center: [this.mapCenter.lat, this.mapCenter.lng],\n        zoom: this.mapZoom\n      });\n      L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n        attribution: \"&copy; OpenStreetMap contributors\"\n      }).addTo(this.map);\n      this.markerLayer = L.layerGroup().addTo(this.map);\n      this.polygonLayer = L.layerGroup().addTo(this.map);\n      this.trafficLayerService.initialize(this.map);\n      this.liveTrafficAvailable = this.trafficLayerService.isLiveAvailable();\n      this.renderZonePolygons();\n    }\n    renderZonePolygons() {\n      if (!this.map || !this.polygonLayer) {\n        return;\n      }\n      this.polygonLayer.clearLayers();\n      this.zoneLayers.clear();\n      this.zones.forEach(zone => {\n        this.zoneService.getZoneBoundary(zone.id).subscribe({\n          next: geoJson => {\n            const congestion = this.getCongestionLevel(zone, this.timeIndex);\n            const color = this.getCongestionColor(congestion);\n            const layer = L.geoJSON(geoJson, {\n              style: {\n                color,\n                fillColor: color,\n                weight: 2,\n                fillOpacity: 0.35\n              }\n            });\n            const bounds = layer.getBounds?.();\n            if (bounds) {\n              this.zoneBounds.set(zone.id, bounds);\n            }\n            layer.eachLayer(featureLayer => {\n              featureLayer.on(\"mouseover\", () => {\n                featureLayer.setStyle({\n                  fillOpacity: 0.55\n                });\n              });\n              featureLayer.on(\"mouseout\", () => {\n                featureLayer.setStyle({\n                  fillOpacity: 0.35\n                });\n              });\n              featureLayer.on(\"click\", () => {\n                this.onZoneSelected(zone);\n              });\n            });\n            this.updateLayerPopup(layer, zone, congestion);\n            this.zoneLayers.set(zone.id, layer);\n            layer.addTo(this.polygonLayer);\n            this.updateHeatmapStyles();\n            if (this.selectedZone?.id === zone.id) {\n              this.refreshTrafficLayer();\n            }\n          }\n        });\n      });\n    }\n    setTrafficMode(mode) {\n      this.trafficMode = mode;\n      if (mode === \"live\") {\n        this.stopAnimation();\n      }\n      this.refreshTrafficLayer();\n    }\n    refreshTrafficLayer() {\n      if (!this.selectedZone || !this.map) {\n        return;\n      }\n      const boundingBox = this.getZoneBoundingBox(this.selectedZone.id);\n      if (this.trafficMode === \"live\") {\n        if (!this.liveTrafficAvailable) {\n          this.trafficMode = \"historical\";\n          this.showHistoricalTraffic();\n          return;\n        }\n        this.trafficLayerService.startLiveUpdates(this.selectedZone, boundingBox);\n        this.lastTrafficUpdate = new Date();\n        return;\n      }\n      this.trafficLayerService.stopLiveUpdates();\n      if (this.trafficMode === \"simulation\") {\n        this.showSimulationTraffic();\n        return;\n      }\n      this.showHistoricalTraffic();\n    }\n    showHistoricalTraffic() {\n      if (!this.selectedZone) return;\n      const time = this.getTimeForSlider();\n      this.trafficLayerService.showHistoricalPattern(this.selectedZone, time, this.getZoneBoundingBox(this.selectedZone.id));\n    }\n    showSimulationTraffic() {\n      if (!this.selectedZone) return;\n      const time = this.getTimeForSlider();\n      this.trafficLayerService.showSimulationResults(this.selectedZone, time, this.getZoneBoundingBox(this.selectedZone.id));\n    }\n    getTimeForSlider() {\n      const time = new Date();\n      time.setHours(this.timeIndex, 0, 0, 0);\n      return time;\n    }\n    getZoneBoundingBox(zoneId) {\n      const bounds = this.zoneBounds.get(zoneId);\n      if (!bounds) return undefined;\n      return `${bounds.getWest()},${bounds.getSouth()},${bounds.getEast()},${bounds.getNorth()}`;\n    }\n    getCongestionLevel(zone, hour) {\n      const base = (() => {\n        switch (zone.zoneType) {\n          case \"Commercial\":\n            return 60;\n          case \"Industrial\":\n            return 55;\n          case \"Mixed\":\n            return 50;\n          case \"Residential\":\n          default:\n            return 40;\n        }\n      })();\n      const morningPeak = hour >= 7 && hour <= 9 ? 18 : 0;\n      const midday = hour >= 12 && hour <= 14 ? 8 : 0;\n      const eveningPeak = hour >= 16 && hour <= 19 ? 22 : 0;\n      const nightRelief = hour >= 21 || hour <= 5 ? -12 : 0;\n      const jitter = this.getZoneJitter(zone.name);\n      const raw = base + morningPeak + midday + eveningPeak + nightRelief + jitter;\n      return Math.max(15, Math.min(95, Math.round(raw)));\n    }\n    getCongestionColor(congestion) {\n      if (congestion < 30) return \"#4CAF50\";\n      if (congestion <= 70) return \"#FFC107\";\n      return \"#F44336\";\n    }\n    getZoneStats(zone, congestion) {\n      const vehiclesPerHour = Math.round(500 + (zone.chargePerHour || 20) * 8);\n      const avgSpeed = Math.max(20, Math.round(60 - congestion * 0.4));\n      return {\n        vehiclesPerHour,\n        avgSpeed,\n        congestion\n      };\n    }\n    updateHeatmapStyles() {\n      if (!this.map || this.zoneLayers.size === 0) {\n        return;\n      }\n      this.zones.forEach(zone => {\n        const layer = this.zoneLayers.get(zone.id);\n        if (!layer) return;\n        const congestion = this.getCongestionLevel(zone, this.timeIndex);\n        const color = this.getCongestionColor(congestion);\n        layer.setStyle({\n          color,\n          fillColor: color,\n          fillOpacity: 0.4\n        });\n        this.updateLayerPopup(layer, zone, congestion);\n      });\n    }\n    updateLayerPopup(layer, zone, congestion) {\n      const stats = this.getZoneStats(zone, congestion);\n      layer.bindPopup(`<strong>${zone.name}</strong><br/>${zone.emirate} • ${zone.zoneType}` + `<br/>Time: ${this.formatHour(this.timeIndex)}` + `<br/>Vehicles/hr: ${stats.vehiclesPerHour}` + `<br/>Avg speed: ${stats.avgSpeed} km/h` + `<br/>Congestion: ${stats.congestion}%`);\n    }\n    getZoneJitter(seed) {\n      let hash = 0;\n      for (let i = 0; i < seed.length; i += 1) {\n        hash = (hash << 5) - hash + seed.charCodeAt(i);\n        hash |= 0;\n      }\n      return Math.abs(hash) % 7 - 3;\n    }\n    getZoneCoordinates(zone) {\n      const fallback = {\n        \"Dubai Marina\": [25.0809, 55.1405],\n        \"Dubai Downtown\": [25.1972, 55.2744],\n        \"Deira Business\": [25.2753, 55.3089],\n        \"Al Qusais\": [25.2847, 55.3764],\n        Satwa: [25.2354, 55.2771],\n        \"Al Quoz\": [25.126, 55.2361],\n        \"Sharjah Residential\": [25.3463, 55.4209],\n        \"Abu Dhabi City\": [24.4667, 54.3667],\n        \"Khalifa City\": [24.4259, 54.5644],\n        \"Reem Island\": [24.4957, 54.4125],\n        \"Musaffah Industrial\": [24.3525, 54.5126],\n        \"Musaffah Residential\": [24.3744, 54.5375]\n      };\n      const lat = zone.latitude;\n      const lng = zone.longitude;\n      if (typeof lat === \"number\" && typeof lng === \"number\") {\n        return [lat, lng];\n      }\n      return fallback[zone.name] ?? [this.mapCenter.lat, this.mapCenter.lng];\n    }\n    setMapViewByEmirate(emirate) {\n      const views = {\n        All: {\n          center: [24.4539, 54.3773],\n          zoom: 8\n        },\n        Dubai: {\n          center: [25.2048, 55.2708],\n          zoom: 10\n        },\n        \"Abu Dhabi\": {\n          center: [24.4539, 54.3773],\n          zoom: 11\n        },\n        Sharjah: {\n          center: [25.3463, 55.4209],\n          zoom: 11\n        }\n      };\n      const view = views[emirate] ?? views[\"All\"];\n      this.mapCenter = {\n        lat: view.center[0],\n        lng: view.center[1]\n      };\n      this.mapZoom = view.zoom;\n      if (this.map) {\n        this.map.setView(view.center, view.zoom);\n      }\n    }\n    static {\n      this.ɵfac = function ZoneMapComponent_Factory(t) {\n        return new (t || ZoneMapComponent)(i0.ɵɵdirectiveInject(i1.ZoneService), i0.ɵɵdirectiveInject(i2.TrafficLayerService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ZoneMapComponent,\n        selectors: [[\"app-zone-map\"]],\n        decls: 42,\n        vars: 17,\n        consts: [[1, \"controls\"], [3, \"click\"], [1, \"traffic-controls\"], [1, \"traffic-toggle\"], [1, \"label\"], [3, \"click\", \"disabled\"], [1, \"traffic-status\"], [\"class\", \"badge live\", 4, \"ngIf\"], [\"class\", \"badge history\", 4, \"ngIf\"], [\"class\", \"badge sim\", 4, \"ngIf\"], [\"class\", \"badge warn\", 4, \"ngIf\"], [\"class\", \"heatmap-controls\", 4, \"ngIf\"], [1, \"heatmap-legend\"], [1, \"legend-bar\"], [1, \"map-container\"], [\"id\", \"zone-map\", 1, \"map\"], [1, \"zones-by-emirate\"], [\"class\", \"loading\", 4, \"ngIf\"], [\"class\", \"error\", 4, \"ngIf\"], [\"class\", \"emirate-group\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"zone-details\", 4, \"ngIf\"], [1, \"badge\", \"live\"], [1, \"badge\", \"history\"], [1, \"badge\", \"sim\"], [1, \"badge\", \"warn\"], [1, \"heatmap-controls\"], [1, \"heatmap-time\"], [\"type\", \"range\", \"min\", \"0\", \"max\", \"23\", \"step\", \"1\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [1, \"btn-heatmap\", 3, \"click\"], [3, \"ngModelChange\", \"change\", \"ngModel\"], [3, \"ngValue\"], [1, \"loading\"], [1, \"error\"], [1, \"emirate-group\"], [1, \"emirate-header\"], [1, \"emirate-flag\"], [1, \"zone-count\"], [1, \"zone-cards-grid\"], [\"class\", \"zone-card\", 3, \"selected\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"zone-card\", 3, \"click\"], [1, \"zone-color-bar\"], [1, \"zone-card-content\"], [1, \"zone-type-badge\"], [1, \"zone-charge\"], [1, \"charge-label\"], [1, \"charge-value\"], [1, \"zone-details\"]],\n        template: function ZoneMapComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"h2\");\n            i0.ɵɵtext(1, \"UAE Zone Map\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(2, \"div\", 0)(3, \"button\", 1);\n            i0.ɵɵlistener(\"click\", function ZoneMapComponent_Template_button_click_3_listener() {\n              return ctx.filterByEmirate(\"All\");\n            });\n            i0.ɵɵtext(4, \"All Zones\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"button\", 1);\n            i0.ɵɵlistener(\"click\", function ZoneMapComponent_Template_button_click_5_listener() {\n              return ctx.filterByEmirate(\"Dubai\");\n            });\n            i0.ɵɵtext(6, \"Dubai\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"button\", 1);\n            i0.ɵɵlistener(\"click\", function ZoneMapComponent_Template_button_click_7_listener() {\n              return ctx.filterByEmirate(\"Abu Dhabi\");\n            });\n            i0.ɵɵtext(8, \"Abu Dhabi\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"button\", 1);\n            i0.ɵɵlistener(\"click\", function ZoneMapComponent_Template_button_click_9_listener() {\n              return ctx.filterByEmirate(\"Sharjah\");\n            });\n            i0.ɵɵtext(10, \"Sharjah\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(11, \"div\", 2)(12, \"div\", 3)(13, \"span\", 4);\n            i0.ɵɵtext(14, \"Traffic Layer:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function ZoneMapComponent_Template_button_click_15_listener() {\n              return ctx.setTrafficMode(\"live\");\n            });\n            i0.ɵɵtext(16, \" Live Traffic \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"button\", 1);\n            i0.ɵɵlistener(\"click\", function ZoneMapComponent_Template_button_click_17_listener() {\n              return ctx.setTrafficMode(\"historical\");\n            });\n            i0.ɵɵtext(18, \" Historical Patterns \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"button\", 1);\n            i0.ɵɵlistener(\"click\", function ZoneMapComponent_Template_button_click_19_listener() {\n              return ctx.setTrafficMode(\"simulation\");\n            });\n            i0.ɵɵtext(20, \" Simulation Results \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(21, \"div\", 6);\n            i0.ɵɵtemplate(22, ZoneMapComponent_span_22_Template, 2, 0, \"span\", 7)(23, ZoneMapComponent_span_23_Template, 2, 0, \"span\", 8)(24, ZoneMapComponent_span_24_Template, 2, 0, \"span\", 9)(25, ZoneMapComponent_span_25_Template, 2, 0, \"span\", 10);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(26, ZoneMapComponent_div_26_Template, 16, 7, \"div\", 11);\n            i0.ɵɵelementStart(27, \"div\", 12)(28, \"span\");\n            i0.ɵɵtext(29, \"Low\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(30, \"div\", 13);\n            i0.ɵɵelementStart(31, \"span\");\n            i0.ɵɵtext(32, \"High\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(33, \"div\", 14);\n            i0.ɵɵelement(34, \"div\", 15);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(35, \"div\", 16)(36, \"h3\");\n            i0.ɵɵtext(37);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(38, ZoneMapComponent_div_38_Template, 2, 0, \"div\", 17)(39, ZoneMapComponent_div_39_Template, 2, 1, \"div\", 18)(40, ZoneMapComponent_div_40_Template, 10, 4, \"div\", 19);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(41, ZoneMapComponent_div_41_Template, 15, 4, \"div\", 20);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(15);\n            i0.ɵɵclassProp(\"active\", ctx.trafficMode === \"live\");\n            i0.ɵɵproperty(\"disabled\", !ctx.liveTrafficAvailable);\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.trafficMode === \"historical\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.trafficMode === \"simulation\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.trafficMode === \"live\" && ctx.liveTrafficAvailable);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.trafficMode === \"historical\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.trafficMode === \"simulation\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.trafficMode === \"live\" && !ctx.liveTrafficAvailable);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.trafficMode === \"historical\" || ctx.trafficMode === \"simulation\");\n            i0.ɵɵadvance(11);\n            i0.ɵɵtextInterpolate1(\"Zones by Emirate (\", ctx.zones.length, \")\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.isLoading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.error);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.zonesByEmirate);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedZone);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.RangeValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgModel],\n        styles: [\".zone-map-container[_ngcontent-%COMP%]{background:#ffffffe6;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);border-radius:20px;padding:1.5rem;box-shadow:0 8px 32px #00000014;border:1px solid rgba(255,255,255,.5);animation:_ngcontent-%COMP%_slideUp .5s ease-out}.map-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:1rem}.map-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#0f172a;display:flex;align-items:center;gap:.5rem}.map-title[_ngcontent-%COMP%]:before{content:\\\"\\\";width:4px;height:20px;background:linear-gradient(180deg,#0d47a1,#f59e0b);border-radius:4px}.map-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.control-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#fff;border:2px solid #E2E8F0;border-radius:8px;font-size:.85rem;font-weight:500;color:#475569;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:.375rem}.control-btn[_ngcontent-%COMP%]:hover{border-color:#0d47a1;color:#0d47a1}.control-btn.active[_ngcontent-%COMP%]{background:#0d47a1;border-color:#0d47a1;color:#fff}.filter-row[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem;flex-wrap:wrap;align-items:center}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:500;color:#64748b}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 2rem .5rem .75rem;font-size:.85rem;background:#fff;border:2px solid #E2E8F0;border-radius:8px;color:#1f2937;cursor:pointer}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d47a1}.time-control[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;background:#f8fafc;padding:.5rem 1rem;border-radius:10px;border:1px solid #E2E8F0}.time-label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:#0d47a1;min-width:70px}.time-slider[_ngcontent-%COMP%]{width:150px;height:6px;-webkit-appearance:none;background:linear-gradient(90deg,#10b981,#f59e0b,#ef4444);border-radius:3px}.time-slider[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:#fff;border:3px solid #0D47A1;border-radius:50%;cursor:pointer;box-shadow:0 2px 6px #00000026}.time-value[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#0f172a;min-width:60px}.traffic-modes[_ngcontent-%COMP%]{display:flex;gap:.25rem;background:#f1f5f9;padding:.25rem;border-radius:10px;margin-bottom:1rem}.traffic-mode-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:transparent;border:none;border-radius:8px;font-size:.85rem;font-weight:500;color:#64748b;cursor:pointer;transition:all .2s ease}.traffic-mode-btn[_ngcontent-%COMP%]:hover{color:#0d47a1}.traffic-mode-btn.active[_ngcontent-%COMP%]{background:#fff;color:#0d47a1;box-shadow:0 2px 6px #00000014}#zone-map[_ngcontent-%COMP%]{height:500px;width:100%;border-radius:16px;overflow:hidden;box-shadow:inset 0 2px 8px #0000001a;border:2px solid #E2E8F0}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffe6;display:flex;align-items:center;justify-content:center;z-index:1000}.loading-spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid #E2E8F0;border-top-color:#0d47a1;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fee2e2,#fecaca);color:#dc2626;padding:1rem;border-radius:12px;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem;font-weight:500;border:1px solid #FCA5A5}.map-legend[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem;flex-wrap:wrap;justify-content:center}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8rem;color:#64748b}.legend-color[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:4px}.legend-color.low[_ngcontent-%COMP%]{background:#10b981}.legend-color.medium[_ngcontent-%COMP%]{background:#f59e0b}.legend-color.high[_ngcontent-%COMP%]{background:#ef4444}.zone-info-panel[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:#fff;border-radius:12px;padding:1rem;box-shadow:0 4px 16px #0000001a;z-index:1000;min-width:200px;border:1px solid #E2E8F0}.zone-info-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#0f172a;margin-bottom:.5rem}.zone-info-panel[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b;margin:0}.zones-by-emirate[_ngcontent-%COMP%]{margin-top:1.5rem}.zones-by-emirate[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:#0f172a;margin-bottom:1rem}.emirate-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.emirate-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background:linear-gradient(135deg,#0d47a1,#1565c0);border-radius:10px;margin-bottom:.75rem;color:#fff}.emirate-header[_ngcontent-%COMP%]   .emirate-flag[_ngcontent-%COMP%]{font-size:1.25rem}.emirate-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin:0;flex:1}.emirate-header[_ngcontent-%COMP%]   .zone-count[_ngcontent-%COMP%]{font-size:.8rem;background:#fff3;padding:.25rem .5rem;border-radius:6px}.zone-cards-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:.75rem}.zone-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;overflow:hidden;border:2px solid #E2E8F0;cursor:pointer;transition:all .2s ease;display:flex}.zone-card[_ngcontent-%COMP%]:hover{border-color:#0d47a1;transform:translateY(-2px);box-shadow:0 8px 20px #0000001a}.zone-card.selected[_ngcontent-%COMP%]{border-color:#0d47a1;background:linear-gradient(135deg,#0d47a10d,#0d47a105)}.zone-color-bar[_ngcontent-%COMP%]{width:6px;flex-shrink:0}.zone-card-content[_ngcontent-%COMP%]{padding:.875rem;flex:1}.zone-card-content[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;color:#0f172a;margin:0 0 .5rem}.zone-type-badge[_ngcontent-%COMP%]{display:inline-block;font-size:.7rem;font-weight:600;color:#64748b;background:#f1f5f9;padding:.2rem .5rem;border-radius:4px;text-transform:uppercase;letter-spacing:.5px}.zone-charge[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:.5rem;padding-top:.5rem;border-top:1px solid #E2E8F0}.zone-charge[_ngcontent-%COMP%]   .charge-label[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b}.zone-charge[_ngcontent-%COMP%]   .charge-value[_ngcontent-%COMP%]{font-size:.85rem;font-weight:700;color:#0d47a1}@media (max-width: 768px){.zone-map-container[_ngcontent-%COMP%]{padding:1rem}.map-header[_ngcontent-%COMP%], .filter-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.time-control[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.time-slider[_ngcontent-%COMP%]{width:100px}#zone-map[_ngcontent-%COMP%]{height:350px}.traffic-modes[_ngcontent-%COMP%]{width:100%}.traffic-mode-btn[_ngcontent-%COMP%]{flex:1;text-align:center}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}\"]\n      });\n    }\n  }\n  return ZoneMapComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}