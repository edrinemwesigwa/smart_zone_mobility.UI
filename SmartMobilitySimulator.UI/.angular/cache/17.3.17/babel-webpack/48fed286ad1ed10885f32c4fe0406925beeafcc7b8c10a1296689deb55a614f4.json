{"ast":null,"code":"import _asyncToGenerator from \"c:/Users/edrin/OneDrive/Desktop/Mobility/SmartZoneSimulator.UI/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as L from \"leaflet\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./traffic-api.service\";\nexport class TrafficLayerService {\n  constructor(trafficApi) {\n    this.trafficApi = trafficApi;\n    this.map = null;\n    this.trafficLayer = null;\n    this.heatmapLayer = null;\n    this.speedLayer = null;\n    this.flowLayer = null;\n    this.incidentLayer = null;\n    this.overlayLayer = null;\n    this.liveRefreshHandle = null;\n  }\n  isLiveAvailable() {\n    return this.trafficApi.isLiveAvailable();\n  }\n  initialize(map) {\n    this.map = map;\n    this.trafficLayer = L.layerGroup().addTo(map);\n    this.speedLayer = L.layerGroup().addTo(map);\n    this.flowLayer = L.layerGroup().addTo(map);\n    this.incidentLayer = L.layerGroup().addTo(map);\n    this.overlayLayer = L.layerGroup().addTo(map);\n    const heatLayerFactory = L.heatLayer;\n    if (heatLayerFactory) {\n      this.heatmapLayer = heatLayerFactory([], {\n        radius: 25,\n        blur: 18,\n        maxZoom: 13\n      }).addTo(map);\n    } else {\n      this.heatmapLayer = L.layerGroup().addTo(map);\n    }\n  }\n  clear() {\n    this.trafficLayer?.clearLayers();\n    this.speedLayer?.clearLayers();\n    this.flowLayer?.clearLayers();\n    this.incidentLayer?.clearLayers();\n    this.overlayLayer?.clearLayers();\n    if (this.heatmapLayer?.setLatLngs) {\n      this.heatmapLayer.setLatLngs([]);\n    } else if (this.heatmapLayer?.clearLayers) {\n      this.heatmapLayer.clearLayers();\n    }\n  }\n  stopLiveUpdates() {\n    if (this.liveRefreshHandle) {\n      window.clearInterval(this.liveRefreshHandle);\n      this.liveRefreshHandle = null;\n    }\n  }\n  startLiveUpdates(zone, boundingBox) {\n    this.stopLiveUpdates();\n    this.showLiveTraffic(zone, boundingBox);\n    this.liveRefreshHandle = window.setInterval(() => {\n      this.showLiveTraffic(zone, boundingBox);\n    }, 5 * 60 * 1000);\n  }\n  showLiveTraffic(zone, boundingBox) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const traffic = yield _this.trafficApi.getLiveTraffic(zone.id);\n      _this.renderTraffic(traffic, zone, boundingBox);\n    })();\n  }\n  showHistoricalPattern(zone, time, boundingBox) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const pattern = yield _this2.trafficApi.getHistoricalPattern(zone.id, time);\n      _this2.renderHistorical(pattern, zone, time, boundingBox);\n    })();\n  }\n  showSimulationResults(zone, time, boundingBox) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const pattern = yield _this3.trafficApi.getHistoricalPattern(zone.id, time);\n      _this3.renderHistorical(pattern, zone, time, boundingBox, true);\n    })();\n  }\n  renderTraffic(traffic, zone, boundingBox) {\n    this.clear();\n    const center = this.getZoneCenter(zone);\n    const bounds = this.getBoundingBox(boundingBox, center);\n    const segments = this.inflateSegments(traffic.segments, bounds);\n    const heatPoints = this.convertSegmentsToHeatmap(segments);\n    this.setHeatmapPoints(heatPoints);\n    this.addFlowLines(segments);\n    this.addSpeedIndicators(segments);\n    this.addIncidents(traffic.incidents, center, bounds);\n  }\n  renderHistorical(pattern, zone, time, boundingBox, isSimulation = false) {\n    this.clear();\n    const center = this.getZoneCenter(zone);\n    const bounds = this.getBoundingBox(boundingBox, center);\n    const segments = this.inflateSegments(pattern.segments, bounds);\n    const heatPoints = this.convertSegmentsToHeatmap(segments);\n    this.setHeatmapPoints(heatPoints);\n    this.addFlowLines(segments, isSimulation);\n    this.addSpeedIndicators(segments);\n    this.addIncidents(pattern.incidents, center, bounds);\n    if (this.isPrayerTime(time)) {\n      this.addPrayerTimeOverlay(center);\n    }\n    if (this.isSchoolTime(time)) {\n      this.highlightSchoolZones(center);\n    }\n    if (this.isConstructionSeason(time)) {\n      this.addConstructionWarnings(center);\n    }\n  }\n  setHeatmapPoints(points) {\n    if (this.heatmapLayer?.setLatLngs) {\n      this.heatmapLayer.setLatLngs(points);\n      return;\n    }\n    if (this.heatmapLayer?.clearLayers) {\n      this.heatmapLayer.clearLayers();\n      points.forEach(([lat, lng, intensity]) => {\n        const circle = L.circleMarker([lat, lng], {\n          radius: 8 + intensity * 8,\n          fillColor: \"#F44336\",\n          fillOpacity: Math.min(0.7, 0.2 + intensity * 0.5),\n          stroke: false\n        });\n        circle.addTo(this.heatmapLayer);\n      });\n    }\n  }\n  convertSegmentsToHeatmap(segments) {\n    return segments.flatMap(segment => {\n      const intensity = Math.min(1, Math.max(0.1, segment.congestionLevel / 100));\n      return segment.path.map(point => [point[0], point[1], intensity]);\n    });\n  }\n  addSpeedIndicators(segments) {\n    if (!this.speedLayer) return;\n    segments.forEach(segment => {\n      const mid = this.getSegmentMidpoint(segment.path);\n      if (!mid) return;\n      const marker = L.marker([mid[0], mid[1]], {\n        icon: L.divIcon({\n          className: \"speed-indicator\",\n          html: `<span>${Math.round(segment.speed)} km/h</span>`\n        })\n      });\n      marker.addTo(this.speedLayer);\n    });\n  }\n  addFlowLines(segments, isSimulation = false) {\n    if (!this.flowLayer) return;\n    segments.forEach(segment => {\n      const color = this.getCongestionColor(segment.congestionLevel);\n      const polyline = L.polyline(segment.path, {\n        color,\n        weight: 4,\n        opacity: isSimulation ? 0.7 : 0.9,\n        dashArray: \"8 10\",\n        className: \"traffic-flow\"\n      });\n      polyline.addTo(this.flowLayer);\n    });\n  }\n  addIncidents(incidents, center, bounds) {\n    if (!this.incidentLayer) return;\n    const seeded = incidents.length > 0 ? incidents : this.generateIncidents(center, bounds);\n    seeded.forEach(incident => {\n      const marker = L.marker([incident.latitude, incident.longitude], {\n        icon: L.divIcon({\n          className: `incident-marker ${incident.severity.toLowerCase()}`,\n          html: `<span>${incident.type}</span>`\n        })\n      });\n      marker.bindPopup(`<strong>${incident.type}</strong><br/>${incident.description}`);\n      marker.addTo(this.incidentLayer);\n    });\n  }\n  addPrayerTimeOverlay(center) {\n    if (!this.overlayLayer) return;\n    const circle = L.circle(center, {\n      radius: 2200,\n      color: \"#5C6BC0\",\n      weight: 2,\n      fillOpacity: 0.08,\n      dashArray: \"6 6\"\n    });\n    circle.bindTooltip(\"Prayer time: reduced traffic\", {\n      permanent: false\n    });\n    circle.addTo(this.overlayLayer);\n  }\n  highlightSchoolZones(center) {\n    if (!this.overlayLayer) return;\n    const offsets = [0.01, -0.012, 0.014];\n    offsets.forEach((offset, index) => {\n      const marker = L.marker([center.lat + offset, center.lng - offset], {\n        icon: L.divIcon({\n          className: \"school-zone-marker\",\n          html: `<span>School ${index + 1}</span>`\n        })\n      });\n      marker.addTo(this.overlayLayer);\n    });\n  }\n  addConstructionWarnings(center) {\n    if (!this.overlayLayer) return;\n    const marker = L.marker([center.lat - 0.015, center.lng + 0.012], {\n      icon: L.divIcon({\n        className: \"construction-marker\",\n        html: \"<span>Construction</span>\"\n      })\n    });\n    marker.addTo(this.overlayLayer);\n  }\n  inflateSegments(segments, bounds) {\n    if (segments.length === 0) {\n      return this.generateSegments(bounds);\n    }\n    return segments.map(segment => ({\n      ...segment,\n      path: segment.path.length > 1 ? segment.path : this.randomPath(bounds)\n    }));\n  }\n  generateSegments(bounds) {\n    const directions = [\"N\", \"S\", \"E\", \"W\"];\n    return directions.map((direction, index) => ({\n      id: `auto-${index}`,\n      path: this.randomPath(bounds),\n      speed: 25 + index * 6,\n      congestionLevel: 40 + index * 10,\n      flowDirection: direction\n    }));\n  }\n  randomPath(bounds) {\n    const start = this.randomPoint(bounds);\n    const end = this.randomPoint(bounds);\n    return [start, end];\n  }\n  randomPoint(bounds) {\n    const lat = bounds.getSouth() + Math.random() * (bounds.getNorth() - bounds.getSouth());\n    const lng = bounds.getWest() + Math.random() * (bounds.getEast() - bounds.getWest());\n    return [lat, lng];\n  }\n  getSegmentMidpoint(path) {\n    if (path.length === 0) return null;\n    const midIndex = Math.floor(path.length / 2);\n    return path[midIndex];\n  }\n  getZoneCenter(zone) {\n    if (typeof zone.latitude === \"number\" && typeof zone.longitude === \"number\") {\n      return L.latLng(zone.latitude, zone.longitude);\n    }\n    return this.map?.getCenter() ?? L.latLng(24.4539, 54.3773);\n  }\n  getBoundingBox(boundingBox, center) {\n    if (boundingBox) {\n      const parts = boundingBox.split(\",\").map(p => Number(p));\n      if (parts.length === 4 && parts.every(p => !Number.isNaN(p))) {\n        return L.latLngBounds([parts[1], parts[0]], [parts[3], parts[2]]);\n      }\n    }\n    const delta = 0.05;\n    return L.latLngBounds([center.lat - delta, center.lng - delta], [center.lat + delta, center.lng + delta]);\n  }\n  getCongestionColor(congestion) {\n    if (congestion < 35) return \"#4CAF50\";\n    if (congestion < 70) return \"#FFC107\";\n    return \"#F44336\";\n  }\n  generateIncidents(center, bounds) {\n    return [{\n      id: \"mock-incident-1\",\n      type: \"Accident\",\n      description: \"Minor collision, right lane blocked\",\n      severity: \"Medium\",\n      latitude: center.lat + 0.01,\n      longitude: center.lng - 0.012\n    }, {\n      id: \"mock-incident-2\",\n      type: \"Roadworks\",\n      description: \"Road maintenance - expect delays\",\n      severity: \"Low\",\n      latitude: bounds.getSouth() + (bounds.getNorth() - bounds.getSouth()) * 0.3,\n      longitude: bounds.getWest() + (bounds.getEast() - bounds.getWest()) * 0.6\n    }];\n  }\n  isPrayerTime(time) {\n    const hour = time.getHours();\n    const day = time.getDay();\n    if (day === 5) {\n      return hour >= 12 && hour < 13;\n    }\n    return hour >= 12 && hour < 13 || hour >= 15 && hour < 16;\n  }\n  isSchoolTime(time) {\n    const hour = time.getHours();\n    const day = time.getDay();\n    if (day === 5 || day === 6) return false;\n    return hour >= 7 && hour <= 9;\n  }\n  isConstructionSeason(time) {\n    return time.getMonth() >= 6 && time.getMonth() <= 9;\n  }\n  static {\n    this.ɵfac = function TrafficLayerService_Factory(t) {\n      return new (t || TrafficLayerService)(i0.ɵɵinject(i1.TrafficApiService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: TrafficLayerService,\n      factory: TrafficLayerService.ɵfac,\n      providedIn: \"root\"\n    });\n  }\n}","map":{"version":3,"names":["L","TrafficLayerService","constructor","trafficApi","map","trafficLayer","heatmapLayer","speedLayer","flowLayer","incidentLayer","overlayLayer","liveRefreshHandle","isLiveAvailable","initialize","layerGroup","addTo","heatLayerFactory","heatLayer","radius","blur","maxZoom","clear","clearLayers","setLatLngs","stopLiveUpdates","window","clearInterval","startLiveUpdates","zone","boundingBox","showLiveTraffic","setInterval","_this","_asyncToGenerator","traffic","getLiveTraffic","id","renderTraffic","showHistoricalPattern","time","_this2","pattern","getHistoricalPattern","renderHistorical","showSimulationResults","_this3","center","getZoneCenter","bounds","getBoundingBox","segments","inflateSegments","heatPoints","convertSegmentsToHeatmap","setHeatmapPoints","addFlowLines","addSpeedIndicators","addIncidents","incidents","isSimulation","isPrayerTime","addPrayerTimeOverlay","isSchoolTime","highlightSchoolZones","isConstructionSeason","addConstructionWarnings","points","forEach","lat","lng","intensity","circle","circleMarker","fillColor","fillOpacity","Math","min","stroke","flatMap","segment","max","congestionLevel","path","point","mid","getSegmentMidpoint","marker","icon","divIcon","className","html","round","speed","color","getCongestionColor","polyline","weight","opacity","dashArray","seeded","length","generateIncidents","incident","latitude","longitude","severity","toLowerCase","type","bindPopup","description","bindTooltip","permanent","offsets","offset","index","generateSegments","randomPath","directions","direction","flowDirection","start","randomPoint","end","getSouth","random","getNorth","getWest","getEast","midIndex","floor","latLng","getCenter","parts","split","p","Number","every","isNaN","latLngBounds","delta","congestion","hour","getHours","day","getDay","getMonth","i0","ɵɵinject","i1","TrafficApiService","factory","ɵfac","providedIn"],"sources":["c:\\Users\\edrin\\OneDrive\\Desktop\\Mobility\\SmartZoneSimulator.UI\\src\\app\\services\\traffic-layer.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport * as L from \"leaflet\";\r\nimport {\r\n  TrafficApiService,\r\n  TrafficData,\r\n  HistoricalPatternResponse,\r\n  TrafficIncident,\r\n  TrafficSegment,\r\n} from \"./traffic-api.service\";\r\nimport { Zone } from \"../models/zone.model\";\r\n\r\n@Injectable({\r\n  providedIn: \"root\",\r\n})\r\nexport class TrafficLayerService {\r\n  private map: L.Map | null = null;\r\n  private trafficLayer: L.LayerGroup | null = null;\r\n  private heatmapLayer: any = null;\r\n  private speedLayer: L.LayerGroup | null = null;\r\n  private flowLayer: L.LayerGroup | null = null;\r\n  private incidentLayer: L.LayerGroup | null = null;\r\n  private overlayLayer: L.LayerGroup | null = null;\r\n  private liveRefreshHandle: number | null = null;\r\n\r\n  constructor(private trafficApi: TrafficApiService) {}\r\n\r\n  isLiveAvailable(): boolean {\r\n    return this.trafficApi.isLiveAvailable();\r\n  }\r\n\r\n  initialize(map: L.Map): void {\r\n    this.map = map;\r\n    this.trafficLayer = L.layerGroup().addTo(map);\r\n    this.speedLayer = L.layerGroup().addTo(map);\r\n    this.flowLayer = L.layerGroup().addTo(map);\r\n    this.incidentLayer = L.layerGroup().addTo(map);\r\n    this.overlayLayer = L.layerGroup().addTo(map);\r\n\r\n    const heatLayerFactory = (L as any).heatLayer;\r\n    if (heatLayerFactory) {\r\n      this.heatmapLayer = heatLayerFactory([], {\r\n        radius: 25,\r\n        blur: 18,\r\n        maxZoom: 13,\r\n      }).addTo(map);\r\n    } else {\r\n      this.heatmapLayer = L.layerGroup().addTo(map);\r\n    }\r\n  }\r\n\r\n  clear(): void {\r\n    this.trafficLayer?.clearLayers();\r\n    this.speedLayer?.clearLayers();\r\n    this.flowLayer?.clearLayers();\r\n    this.incidentLayer?.clearLayers();\r\n    this.overlayLayer?.clearLayers();\r\n    if (this.heatmapLayer?.setLatLngs) {\r\n      this.heatmapLayer.setLatLngs([]);\r\n    } else if (this.heatmapLayer?.clearLayers) {\r\n      this.heatmapLayer.clearLayers();\r\n    }\r\n  }\r\n\r\n  stopLiveUpdates(): void {\r\n    if (this.liveRefreshHandle) {\r\n      window.clearInterval(this.liveRefreshHandle);\r\n      this.liveRefreshHandle = null;\r\n    }\r\n  }\r\n\r\n  startLiveUpdates(zone: Zone, boundingBox?: string): void {\r\n    this.stopLiveUpdates();\r\n    this.showLiveTraffic(zone, boundingBox);\r\n    this.liveRefreshHandle = window.setInterval(\r\n      () => {\r\n        this.showLiveTraffic(zone, boundingBox);\r\n      },\r\n      5 * 60 * 1000,\r\n    );\r\n  }\r\n\r\n  async showLiveTraffic(zone: Zone, boundingBox?: string): Promise<void> {\r\n    const traffic = await this.trafficApi.getLiveTraffic(zone.id);\r\n    this.renderTraffic(traffic, zone, boundingBox);\r\n  }\r\n\r\n  async showHistoricalPattern(\r\n    zone: Zone,\r\n    time: Date,\r\n    boundingBox?: string,\r\n  ): Promise<void> {\r\n    const pattern = await this.trafficApi.getHistoricalPattern(zone.id, time);\r\n    this.renderHistorical(pattern, zone, time, boundingBox);\r\n  }\r\n\r\n  async showSimulationResults(\r\n    zone: Zone,\r\n    time: Date,\r\n    boundingBox?: string,\r\n  ): Promise<void> {\r\n    const pattern = await this.trafficApi.getHistoricalPattern(zone.id, time);\r\n    this.renderHistorical(pattern, zone, time, boundingBox, true);\r\n  }\r\n\r\n  private renderTraffic(\r\n    traffic: TrafficData,\r\n    zone: Zone,\r\n    boundingBox?: string,\r\n  ): void {\r\n    this.clear();\r\n    const center = this.getZoneCenter(zone);\r\n    const bounds = this.getBoundingBox(boundingBox, center);\r\n\r\n    const segments = this.inflateSegments(traffic.segments, bounds);\r\n    const heatPoints = this.convertSegmentsToHeatmap(segments);\r\n\r\n    this.setHeatmapPoints(heatPoints);\r\n    this.addFlowLines(segments);\r\n    this.addSpeedIndicators(segments);\r\n    this.addIncidents(traffic.incidents, center, bounds);\r\n  }\r\n\r\n  private renderHistorical(\r\n    pattern: HistoricalPatternResponse,\r\n    zone: Zone,\r\n    time: Date,\r\n    boundingBox?: string,\r\n    isSimulation = false,\r\n  ): void {\r\n    this.clear();\r\n    const center = this.getZoneCenter(zone);\r\n    const bounds = this.getBoundingBox(boundingBox, center);\r\n\r\n    const segments = this.inflateSegments(pattern.segments, bounds);\r\n    const heatPoints = this.convertSegmentsToHeatmap(segments);\r\n\r\n    this.setHeatmapPoints(heatPoints);\r\n    this.addFlowLines(segments, isSimulation);\r\n    this.addSpeedIndicators(segments);\r\n    this.addIncidents(pattern.incidents, center, bounds);\r\n\r\n    if (this.isPrayerTime(time)) {\r\n      this.addPrayerTimeOverlay(center);\r\n    }\r\n\r\n    if (this.isSchoolTime(time)) {\r\n      this.highlightSchoolZones(center);\r\n    }\r\n\r\n    if (this.isConstructionSeason(time)) {\r\n      this.addConstructionWarnings(center);\r\n    }\r\n  }\r\n\r\n  private setHeatmapPoints(points: [number, number, number][]): void {\r\n    if (this.heatmapLayer?.setLatLngs) {\r\n      this.heatmapLayer.setLatLngs(points);\r\n      return;\r\n    }\r\n\r\n    if (this.heatmapLayer?.clearLayers) {\r\n      this.heatmapLayer.clearLayers();\r\n      points.forEach(([lat, lng, intensity]) => {\r\n        const circle = L.circleMarker([lat, lng], {\r\n          radius: 8 + intensity * 8,\r\n          fillColor: \"#F44336\",\r\n          fillOpacity: Math.min(0.7, 0.2 + intensity * 0.5),\r\n          stroke: false,\r\n        });\r\n        circle.addTo(this.heatmapLayer);\r\n      });\r\n    }\r\n  }\r\n\r\n  private convertSegmentsToHeatmap(\r\n    segments: TrafficSegment[],\r\n  ): [number, number, number][] {\r\n    return segments.flatMap((segment) => {\r\n      const intensity = Math.min(\r\n        1,\r\n        Math.max(0.1, segment.congestionLevel / 100),\r\n      );\r\n      return segment.path.map((point): [number, number, number] => [\r\n        point[0],\r\n        point[1],\r\n        intensity,\r\n      ]);\r\n    });\r\n  }\r\n\r\n  private addSpeedIndicators(segments: TrafficSegment[]): void {\r\n    if (!this.speedLayer) return;\r\n\r\n    segments.forEach((segment) => {\r\n      const mid = this.getSegmentMidpoint(segment.path);\r\n      if (!mid) return;\r\n\r\n      const marker = L.marker([mid[0], mid[1]], {\r\n        icon: L.divIcon({\r\n          className: \"speed-indicator\",\r\n          html: `<span>${Math.round(segment.speed)} km/h</span>`,\r\n        }),\r\n      });\r\n      marker.addTo(this.speedLayer!);\r\n    });\r\n  }\r\n\r\n  private addFlowLines(segments: TrafficSegment[], isSimulation = false): void {\r\n    if (!this.flowLayer) return;\r\n\r\n    segments.forEach((segment) => {\r\n      const color = this.getCongestionColor(segment.congestionLevel);\r\n      const polyline = L.polyline(segment.path, {\r\n        color,\r\n        weight: 4,\r\n        opacity: isSimulation ? 0.7 : 0.9,\r\n        dashArray: \"8 10\",\r\n        className: \"traffic-flow\",\r\n      });\r\n      polyline.addTo(this.flowLayer!);\r\n    });\r\n  }\r\n\r\n  private addIncidents(\r\n    incidents: TrafficIncident[],\r\n    center: L.LatLng,\r\n    bounds: L.LatLngBounds,\r\n  ): void {\r\n    if (!this.incidentLayer) return;\r\n\r\n    const seeded =\r\n      incidents.length > 0 ? incidents : this.generateIncidents(center, bounds);\r\n    seeded.forEach((incident) => {\r\n      const marker = L.marker([incident.latitude, incident.longitude], {\r\n        icon: L.divIcon({\r\n          className: `incident-marker ${incident.severity.toLowerCase()}`,\r\n          html: `<span>${incident.type}</span>`,\r\n        }),\r\n      });\r\n      marker.bindPopup(\r\n        `<strong>${incident.type}</strong><br/>${incident.description}`,\r\n      );\r\n      marker.addTo(this.incidentLayer!);\r\n    });\r\n  }\r\n\r\n  private addPrayerTimeOverlay(center: L.LatLng): void {\r\n    if (!this.overlayLayer) return;\r\n    const circle = L.circle(center, {\r\n      radius: 2200,\r\n      color: \"#5C6BC0\",\r\n      weight: 2,\r\n      fillOpacity: 0.08,\r\n      dashArray: \"6 6\",\r\n    });\r\n    circle.bindTooltip(\"Prayer time: reduced traffic\", { permanent: false });\r\n    circle.addTo(this.overlayLayer);\r\n  }\r\n\r\n  private highlightSchoolZones(center: L.LatLng): void {\r\n    if (!this.overlayLayer) return;\r\n    const offsets = [0.01, -0.012, 0.014];\r\n    offsets.forEach((offset, index) => {\r\n      const marker = L.marker([center.lat + offset, center.lng - offset], {\r\n        icon: L.divIcon({\r\n          className: \"school-zone-marker\",\r\n          html: `<span>School ${index + 1}</span>`,\r\n        }),\r\n      });\r\n      marker.addTo(this.overlayLayer!);\r\n    });\r\n  }\r\n\r\n  private addConstructionWarnings(center: L.LatLng): void {\r\n    if (!this.overlayLayer) return;\r\n    const marker = L.marker([center.lat - 0.015, center.lng + 0.012], {\r\n      icon: L.divIcon({\r\n        className: \"construction-marker\",\r\n        html: \"<span>Construction</span>\",\r\n      }),\r\n    });\r\n    marker.addTo(this.overlayLayer!);\r\n  }\r\n\r\n  private inflateSegments(\r\n    segments: TrafficSegment[],\r\n    bounds: L.LatLngBounds,\r\n  ): TrafficSegment[] {\r\n    if (segments.length === 0) {\r\n      return this.generateSegments(bounds);\r\n    }\r\n\r\n    return segments.map((segment) => ({\r\n      ...segment,\r\n      path: segment.path.length > 1 ? segment.path : this.randomPath(bounds),\r\n    }));\r\n  }\r\n\r\n  private generateSegments(bounds: L.LatLngBounds): TrafficSegment[] {\r\n    const directions: TrafficSegment[\"flowDirection\"][] = [\"N\", \"S\", \"E\", \"W\"];\r\n    return directions.map((direction, index) => ({\r\n      id: `auto-${index}`,\r\n      path: this.randomPath(bounds),\r\n      speed: 25 + index * 6,\r\n      congestionLevel: 40 + index * 10,\r\n      flowDirection: direction,\r\n    }));\r\n  }\r\n\r\n  private randomPath(bounds: L.LatLngBounds): [number, number][] {\r\n    const start = this.randomPoint(bounds);\r\n    const end = this.randomPoint(bounds);\r\n    return [start, end];\r\n  }\r\n\r\n  private randomPoint(bounds: L.LatLngBounds): [number, number] {\r\n    const lat =\r\n      bounds.getSouth() +\r\n      Math.random() * (bounds.getNorth() - bounds.getSouth());\r\n    const lng =\r\n      bounds.getWest() + Math.random() * (bounds.getEast() - bounds.getWest());\r\n    return [lat, lng];\r\n  }\r\n\r\n  private getSegmentMidpoint(\r\n    path: [number, number][],\r\n  ): [number, number] | null {\r\n    if (path.length === 0) return null;\r\n    const midIndex = Math.floor(path.length / 2);\r\n    return path[midIndex];\r\n  }\r\n\r\n  private getZoneCenter(zone: Zone): L.LatLng {\r\n    if (\r\n      typeof zone.latitude === \"number\" &&\r\n      typeof zone.longitude === \"number\"\r\n    ) {\r\n      return L.latLng(zone.latitude, zone.longitude);\r\n    }\r\n\r\n    return this.map?.getCenter() ?? L.latLng(24.4539, 54.3773);\r\n  }\r\n\r\n  private getBoundingBox(\r\n    boundingBox: string | undefined,\r\n    center: L.LatLng,\r\n  ): L.LatLngBounds {\r\n    if (boundingBox) {\r\n      const parts = boundingBox.split(\",\").map((p) => Number(p));\r\n      if (parts.length === 4 && parts.every((p) => !Number.isNaN(p))) {\r\n        return L.latLngBounds([parts[1], parts[0]], [parts[3], parts[2]]);\r\n      }\r\n    }\r\n\r\n    const delta = 0.05;\r\n    return L.latLngBounds(\r\n      [center.lat - delta, center.lng - delta],\r\n      [center.lat + delta, center.lng + delta],\r\n    );\r\n  }\r\n\r\n  private getCongestionColor(congestion: number): string {\r\n    if (congestion < 35) return \"#4CAF50\";\r\n    if (congestion < 70) return \"#FFC107\";\r\n    return \"#F44336\";\r\n  }\r\n\r\n  private generateIncidents(\r\n    center: L.LatLng,\r\n    bounds: L.LatLngBounds,\r\n  ): TrafficIncident[] {\r\n    return [\r\n      {\r\n        id: \"mock-incident-1\",\r\n        type: \"Accident\",\r\n        description: \"Minor collision, right lane blocked\",\r\n        severity: \"Medium\",\r\n        latitude: center.lat + 0.01,\r\n        longitude: center.lng - 0.012,\r\n      },\r\n      {\r\n        id: \"mock-incident-2\",\r\n        type: \"Roadworks\",\r\n        description: \"Road maintenance - expect delays\",\r\n        severity: \"Low\",\r\n        latitude:\r\n          bounds.getSouth() + (bounds.getNorth() - bounds.getSouth()) * 0.3,\r\n        longitude:\r\n          bounds.getWest() + (bounds.getEast() - bounds.getWest()) * 0.6,\r\n      },\r\n    ];\r\n  }\r\n\r\n  private isPrayerTime(time: Date): boolean {\r\n    const hour = time.getHours();\r\n    const day = time.getDay();\r\n\r\n    if (day === 5) {\r\n      return hour >= 12 && hour < 13;\r\n    }\r\n\r\n    return (hour >= 12 && hour < 13) || (hour >= 15 && hour < 16);\r\n  }\r\n\r\n  private isSchoolTime(time: Date): boolean {\r\n    const hour = time.getHours();\r\n    const day = time.getDay();\r\n\r\n    if (day === 5 || day === 6) return false;\r\n    return hour >= 7 && hour <= 9;\r\n  }\r\n\r\n  private isConstructionSeason(time: Date): boolean {\r\n    return time.getMonth() >= 6 && time.getMonth() <= 9;\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}