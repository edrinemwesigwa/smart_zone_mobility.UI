{"ast":null,"code":"import { BehaviorSubject } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nexport let ScenarioService = /*#__PURE__*/(() => {\n  class ScenarioService {\n    constructor() {\n      this.STORAGE_KEY = \"smartzone_scenarios\";\n      this.AUDIT_KEY = \"smartzone_audit_log\";\n      this.scenariosSubject = new BehaviorSubject([]);\n      this.auditLogSubject = new BehaviorSubject([]);\n      this.scenarios$ = this.scenariosSubject.asObservable();\n      this.auditLog$ = this.auditLogSubject.asObservable();\n      this.loadScenarios();\n      this.loadAuditLog();\n    }\n    // Scenario Management\n    saveScenario(scenario) {\n      const scenarios = this.scenariosSubject.getValue();\n      const newScenario = {\n        ...scenario,\n        id: this.generateId(),\n        createdAt: new Date(),\n        updatedAt: new Date()\n      };\n      scenarios.push(newScenario);\n      this.scenariosSubject.next(scenarios);\n      this.saveToStorage();\n      this.logAction(\"scenario_saved\", `Saved scenario: ${scenario.name}`, `Zone: ${scenario.zoneName}`);\n      return newScenario;\n    }\n    updateScenario(id, updates) {\n      const scenarios = this.scenariosSubject.getValue();\n      const index = scenarios.findIndex(s => s.id === id);\n      if (index === -1) return null;\n      scenarios[index] = {\n        ...scenarios[index],\n        ...updates,\n        updatedAt: new Date()\n      };\n      this.scenariosSubject.next([...scenarios]);\n      this.saveToStorage();\n      this.logAction(\"scenario_saved\", `Updated scenario: ${scenarios[index].name}`, `Zone: ${scenarios[index].zoneName}`);\n      return scenarios[index];\n    }\n    deleteScenario(id) {\n      const scenarios = this.scenariosSubject.getValue();\n      const index = scenarios.findIndex(s => s.id === id);\n      if (index === -1) return false;\n      const deleted = scenarios[index];\n      scenarios.splice(index, 1);\n      this.scenariosSubject.next([...scenarios]);\n      this.saveToStorage();\n      this.logAction(\"scenario_deleted\", `Deleted scenario: ${deleted.name}`, `Zone: ${deleted.zoneName}`);\n      return true;\n    }\n    loadScenario(id) {\n      const scenarios = this.scenariosSubject.getValue();\n      const scenario = scenarios.find(s => s.id === id);\n      if (scenario) {\n        this.logAction(\"scenario_loaded\", `Loaded scenario: ${scenario.name}`, `Zone: ${scenario.zoneName}`);\n      }\n      return scenario || null;\n    }\n    getAllScenarios() {\n      return this.scenariosSubject.getValue();\n    }\n    // Audit Log\n    logAction(action, description, details) {\n      const log = this.auditLogSubject.getValue();\n      const newEntry = {\n        id: this.generateId(),\n        action,\n        description,\n        details,\n        timestamp: new Date()\n      };\n      log.unshift(newEntry);\n      // Keep only last 100 entries\n      if (log.length > 100) {\n        log.pop();\n      }\n      this.auditLogSubject.next([...log]);\n      this.saveAuditLog();\n    }\n    getAuditLog() {\n      return this.auditLogSubject.getValue();\n    }\n    getAuditLogByAction(action) {\n      return this.auditLogSubject.getValue().filter(entry => entry.action === action);\n    }\n    clearAuditLog() {\n      this.auditLogSubject.next([]);\n      this.saveAuditLog();\n    }\n    // Export/Import\n    exportScenarios() {\n      const scenarios = this.scenariosSubject.getValue();\n      return JSON.stringify(scenarios, null, 2);\n    }\n    importScenarios(json) {\n      try {\n        const scenarios = JSON.parse(json);\n        if (Array.isArray(scenarios)) {\n          this.scenariosSubject.next(scenarios);\n          this.saveToStorage();\n          return true;\n        }\n        return false;\n      } catch {\n        return false;\n      }\n    }\n    // Private methods\n    generateId() {\n      return Date.now().toString(36) + Math.random().toString(36).substr(2);\n    }\n    loadScenarios() {\n      try {\n        const stored = localStorage.getItem(this.STORAGE_KEY);\n        if (stored) {\n          const scenarios = JSON.parse(stored);\n          this.scenariosSubject.next(scenarios);\n        }\n      } catch {\n        this.scenariosSubject.next([]);\n      }\n    }\n    saveToStorage() {\n      try {\n        localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.scenariosSubject.getValue()));\n      } catch {\n        console.error(\"Failed to save scenarios to localStorage\");\n      }\n    }\n    loadAuditLog() {\n      try {\n        const stored = localStorage.getItem(this.AUDIT_KEY);\n        if (stored) {\n          const log = JSON.parse(stored);\n          this.auditLogSubject.next(log);\n        }\n      } catch {\n        this.auditLogSubject.next([]);\n      }\n    }\n    saveAuditLog() {\n      try {\n        localStorage.setItem(this.AUDIT_KEY, JSON.stringify(this.auditLogSubject.getValue()));\n      } catch {\n        console.error(\"Failed to save audit log to localStorage\");\n      }\n    }\n    static {\n      this.ɵfac = function ScenarioService_Factory(t) {\n        return new (t || ScenarioService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: ScenarioService,\n        factory: ScenarioService.ɵfac,\n        providedIn: \"root\"\n      });\n    }\n  }\n  return ScenarioService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}