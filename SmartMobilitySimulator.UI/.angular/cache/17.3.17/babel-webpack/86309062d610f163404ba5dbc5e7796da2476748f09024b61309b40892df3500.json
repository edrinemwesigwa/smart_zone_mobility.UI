{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/edrin/OneDrive/Desktop/Mobility/SmartZoneSimulator.UI/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { firstValueFrom } from \"rxjs\";\nimport { getApiBase } from \"./api-base\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class TrafficApiService {\n  constructor(http) {\n    this.http = http;\n    this.apiUrl = `${getApiBase()}/api/traffic`;\n    this.liveApiEnabled = true;\n  }\n  isLiveAvailable() {\n    return this.liveApiEnabled;\n  }\n  getLiveTraffic(zoneId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        return yield firstValueFrom(_this.http.get(`${_this.apiUrl}/live/${zoneId}`));\n      } catch {\n        return _this.buildMockTraffic(zoneId);\n      }\n    })();\n  }\n  getHistoricalPattern(zoneId, time) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        return yield firstValueFrom(_this2.http.get(`${_this2.apiUrl}/historical/${zoneId}`, {\n          params: {\n            time: time.toISOString()\n          }\n        }));\n      } catch {\n        return _this2.buildMockHistorical(time);\n      }\n    })();\n  }\n  getIncidents(area) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        return yield firstValueFrom(_this3.http.get(`${_this3.apiUrl}/incidents`, {\n          params: {\n            area\n          }\n        }));\n      } catch {\n        return [];\n      }\n    })();\n  }\n  buildMockTraffic(zoneId) {\n    const segments = this.mockSegments();\n    const avgSpeed = segments.reduce((sum, s) => sum + s.speed, 0) / (segments.length || 1);\n    const congestion = segments.reduce((sum, s) => sum + s.congestionLevel, 0) / (segments.length || 1);\n    return {\n      averageSpeed: Math.round(avgSpeed * 10) / 10,\n      congestionLevel: Math.round(congestion),\n      timestamp: new Date().toISOString(),\n      reliability: 0.7,\n      segments,\n      incidents: this.mockIncidents()\n    };\n  }\n  buildMockHistorical(time) {\n    const hour = time.getHours();\n    const baseSpeed = hour >= 7 && hour <= 9 ? 25 : hour >= 16 && hour <= 19 ? 28 : 55;\n    const congestion = hour >= 7 && hour <= 9 ? 75 : hour >= 16 && hour <= 19 ? 70 : 40;\n    return {\n      points: [],\n      segments: this.mockSegments(baseSpeed),\n      incidents: this.mockIncidents(),\n      baseSpeed,\n      congestionLevel: congestion\n    };\n  }\n  mockSegments(baseSpeed = 40) {\n    const speeds = [baseSpeed - 5, baseSpeed, baseSpeed + 6, baseSpeed - 8];\n    const congestionLevels = [60, 40, 30, 70];\n    const directions = [\"N\", \"S\", \"E\", \"W\"];\n    return speeds.map((speed, index) => ({\n      id: `seg-${index + 1}`,\n      path: [],\n      speed: Math.max(15, speed),\n      congestionLevel: congestionLevels[index] ?? 50,\n      flowDirection: directions[index] ?? \"N\"\n    }));\n  }\n  mockIncidents() {\n    return [{\n      id: \"incident-1\",\n      type: \"Roadworks\",\n      description: \"Lane closure due to maintenance\",\n      severity: \"Medium\",\n      latitude: 25.2048,\n      longitude: 55.2708\n    }, {\n      id: \"incident-2\",\n      type: \"Accident\",\n      description: \"Minor collision, expect delays\",\n      severity: \"Low\",\n      latitude: 24.4539,\n      longitude: 54.3773\n    }];\n  }\n  static {\n    this.ɵfac = function TrafficApiService_Factory(t) {\n      return new (t || TrafficApiService)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: TrafficApiService,\n      factory: TrafficApiService.ɵfac,\n      providedIn: \"root\"\n    });\n  }\n}","map":{"version":3,"names":["firstValueFrom","getApiBase","TrafficApiService","constructor","http","apiUrl","liveApiEnabled","isLiveAvailable","getLiveTraffic","zoneId","_this","_asyncToGenerator","get","buildMockTraffic","getHistoricalPattern","time","_this2","params","toISOString","buildMockHistorical","getIncidents","area","_this3","segments","mockSegments","avgSpeed","reduce","sum","s","speed","length","congestion","congestionLevel","averageSpeed","Math","round","timestamp","Date","reliability","incidents","mockIncidents","hour","getHours","baseSpeed","points","speeds","congestionLevels","directions","map","index","id","path","max","flowDirection","type","description","severity","latitude","longitude","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\Users\\edrin\\OneDrive\\Desktop\\Mobility\\SmartZoneSimulator.UI\\src\\app\\services\\traffic-api.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport { HttpClient } from \"@angular/common/http\";\r\nimport { firstValueFrom } from \"rxjs\";\r\nimport { getApiBase } from \"./api-base\";\r\n\r\nexport interface TrafficData {\r\n  averageSpeed: number;\r\n  congestionLevel: number;\r\n  timestamp: string;\r\n  reliability: number;\r\n  segments: TrafficSegment[];\r\n  incidents: TrafficIncident[];\r\n}\r\n\r\nexport interface TrafficSegment {\r\n  id: string;\r\n  path: [number, number][];\r\n  speed: number;\r\n  congestionLevel: number;\r\n  flowDirection: \"N\" | \"S\" | \"E\" | \"W\" | \"NE\" | \"NW\" | \"SE\" | \"SW\";\r\n}\r\n\r\nexport interface TrafficIncident {\r\n  id: string;\r\n  type: \"Accident\" | \"Roadworks\" | \"Closure\" | \"Event\";\r\n  description: string;\r\n  severity: \"Low\" | \"Medium\" | \"High\";\r\n  latitude: number;\r\n  longitude: number;\r\n  startTime?: string;\r\n  endTime?: string;\r\n}\r\n\r\nexport interface HistoricalPatternResponse {\r\n  points: [number, number, number][];\r\n  segments: TrafficSegment[];\r\n  incidents: TrafficIncident[];\r\n  baseSpeed: number;\r\n  congestionLevel: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: \"root\",\r\n})\r\nexport class TrafficApiService {\r\n  private apiUrl = `${getApiBase()}/api/traffic`;\r\n  private liveApiEnabled = true;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  isLiveAvailable(): boolean {\r\n    return this.liveApiEnabled;\r\n  }\r\n\r\n  async getLiveTraffic(zoneId: string): Promise<TrafficData> {\r\n    try {\r\n      return await firstValueFrom(\r\n        this.http.get<TrafficData>(`${this.apiUrl}/live/${zoneId}`),\r\n      );\r\n    } catch {\r\n      return this.buildMockTraffic(zoneId);\r\n    }\r\n  }\r\n\r\n  async getHistoricalPattern(\r\n    zoneId: string,\r\n    time: Date,\r\n  ): Promise<HistoricalPatternResponse> {\r\n    try {\r\n      return await firstValueFrom(\r\n        this.http.get<HistoricalPatternResponse>(\r\n          `${this.apiUrl}/historical/${zoneId}`,\r\n          {\r\n            params: { time: time.toISOString() },\r\n          },\r\n        ),\r\n      );\r\n    } catch {\r\n      return this.buildMockHistorical(time);\r\n    }\r\n  }\r\n\r\n  async getIncidents(area: string): Promise<TrafficIncident[]> {\r\n    try {\r\n      return await firstValueFrom(\r\n        this.http.get<TrafficIncident[]>(`${this.apiUrl}/incidents`, {\r\n          params: { area },\r\n        }),\r\n      );\r\n    } catch {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  private buildMockTraffic(zoneId: string): TrafficData {\r\n    const segments = this.mockSegments();\r\n    const avgSpeed =\r\n      segments.reduce((sum, s) => sum + s.speed, 0) / (segments.length || 1);\r\n    const congestion =\r\n      segments.reduce((sum, s) => sum + s.congestionLevel, 0) /\r\n      (segments.length || 1);\r\n\r\n    return {\r\n      averageSpeed: Math.round(avgSpeed * 10) / 10,\r\n      congestionLevel: Math.round(congestion),\r\n      timestamp: new Date().toISOString(),\r\n      reliability: 0.7,\r\n      segments,\r\n      incidents: this.mockIncidents(),\r\n    };\r\n  }\r\n\r\n  private buildMockHistorical(time: Date): HistoricalPatternResponse {\r\n    const hour = time.getHours();\r\n    const baseSpeed =\r\n      hour >= 7 && hour <= 9 ? 25 : hour >= 16 && hour <= 19 ? 28 : 55;\r\n    const congestion =\r\n      hour >= 7 && hour <= 9 ? 75 : hour >= 16 && hour <= 19 ? 70 : 40;\r\n\r\n    return {\r\n      points: [],\r\n      segments: this.mockSegments(baseSpeed),\r\n      incidents: this.mockIncidents(),\r\n      baseSpeed,\r\n      congestionLevel: congestion,\r\n    };\r\n  }\r\n\r\n  private mockSegments(baseSpeed: number = 40): TrafficSegment[] {\r\n    const speeds = [baseSpeed - 5, baseSpeed, baseSpeed + 6, baseSpeed - 8];\r\n    const congestionLevels = [60, 40, 30, 70];\r\n    const directions: TrafficSegment[\"flowDirection\"][] = [\"N\", \"S\", \"E\", \"W\"];\r\n\r\n    return speeds.map((speed, index) => ({\r\n      id: `seg-${index + 1}`,\r\n      path: [],\r\n      speed: Math.max(15, speed),\r\n      congestionLevel: congestionLevels[index] ?? 50,\r\n      flowDirection: directions[index] ?? \"N\",\r\n    }));\r\n  }\r\n\r\n  private mockIncidents(): TrafficIncident[] {\r\n    return [\r\n      {\r\n        id: \"incident-1\",\r\n        type: \"Roadworks\",\r\n        description: \"Lane closure due to maintenance\",\r\n        severity: \"Medium\",\r\n        latitude: 25.2048,\r\n        longitude: 55.2708,\r\n      },\r\n      {\r\n        id: \"incident-2\",\r\n        type: \"Accident\",\r\n        description: \"Minor collision, expect delays\",\r\n        severity: \"Low\",\r\n        latitude: 24.4539,\r\n        longitude: 54.3773,\r\n      },\r\n    ];\r\n  }\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}