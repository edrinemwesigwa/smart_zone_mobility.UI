{"version":3,"file":"html-to-pptx.min.js","sources":["../node_modules/tslib/tslib.es6.js","../src/styleTransform.ts","../src/animationTransform.ts","../src/analyze.ts","../src/index.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","// styleTransform.ts\r\n\r\nimport PptxGenJS from \"pptxgenjs\";\r\n\r\nexport interface ElementStyle {\r\n  x: number;\r\n  y: number;\r\n  w: number;\r\n  h: number;\r\n\r\n  // 文本相关（单位 pt）\r\n  fontSize?: number;\r\n  fontFace?: string;\r\n  color?: string;\r\n  align?: PptxGenJS.HAlign;\r\n  valign?: PptxGenJS.VAlign;\r\n  lineSpacing?: number; // pt\r\n  charSpacing?: number; // pt\r\n\r\n  // 填充/边框\r\n  fill?: { color: string; transparency?: number };\r\n  border?: { pt: number; color: string; type?: any };\r\n\r\n  bold?: boolean;\r\n  italic?: boolean;\r\n  underline?: any;\r\n  strike?: boolean;\r\n  padding?: number | [number, number, number, number];\r\n  shapeType: \"rect\" | \"roundRect\" | \"ellipse\";\r\n  rectRadius?: number;\r\n  opacity?: number;\r\n  rotate?: number; //  旋转角度\r\n}\r\n\r\nexport function colorToHex(color: string): string {\r\n  if (!color || color === \"transparent\" || color === \"inherit\") return \"\";\r\n  if (color.startsWith(\"#\")) return color.replace(\"#\", \"\").toUpperCase();\r\n  if (color.startsWith(\"rgb\")) {\r\n    const rgba = color.match(/(\\d+(\\.\\d+)?)/g);\r\n    if (rgba && rgba.length >= 3) {\r\n      if (rgba.length > 3 && parseFloat(rgba[3]) === 0) return \"\";\r\n      const r = parseInt(rgba[0], 10).toString(16).padStart(2, \"0\");\r\n      const g = parseInt(rgba[1], 10).toString(16).padStart(2, \"0\");\r\n      const b = parseInt(rgba[2], 10).toString(16).padStart(2, \"0\");\r\n      return (r + g + b).toUpperCase();\r\n    }\r\n  }\r\n  return \"000000\";\r\n}\r\n\r\n/**\r\n * 计算最终的透明度 (0-100, 0是不透明)\r\n * 结合了 rgba 的 alpha 通道 和 css 的 opacity 属性\r\n */\r\nfunction getMixedTransparency(colorStr: string, cssOpacity: string): number | undefined {\r\n  let alpha = 1;\r\n  // 1. 解析 CSS Opacity (0 ~ 1)\r\n  const elementOpacity = parseFloat(cssOpacity);\r\n  if (!isNaN(elementOpacity)) {\r\n    alpha *= elementOpacity;\r\n  }\r\n  // 2. 解析 RGBA Alpha\r\n  if (colorStr && colorStr.startsWith(\"rgba\")) {\r\n    const rgba = colorStr.match(/(\\d+(\\.\\d+)?)/g);\r\n    if (rgba && rgba.length >= 4) {\r\n      const colorAlpha = parseFloat(rgba[3]);\r\n      alpha *= colorAlpha;\r\n    }\r\n  }\r\n  // 如果完全不透明 (alpha=1)，返回 undefined 让 pptxgenjs 使用默认\r\n  if (alpha >= 1) return undefined;\r\n\r\n  // PPTX Transparency is 0 (opaque) to 100 (fully transparent)\r\n  return Math.round((1 - alpha) * 100);\r\n}\r\n\r\n/**\r\n * 将元素的 CSS 计算样式转换为 PPT 坐标/样式\r\n * 注意：坐标和尺寸 x/y/w/h 使用 globalScale/pageTransformScale 缩放；\r\n * 字体/行高/边框等“点数”属性仅进行单位转换 px->pt，不乘 globalScale，避免双重缩放。\r\n */\r\nexport function getComputedElementStyle(element: Element, pageRect: DOMRect, globalScale: number, pageTransformScale: number): ElementStyle {\r\n  const style = window.getComputedStyle(element);\r\n  const rect = element.getBoundingClientRect();\r\n\r\n  // 坐标/尺寸：px -> ppt英寸(基于 globalScale)，pptxgenjs 用英寸单位；这里维持你现有的比例策略：\r\n  // 现有项目通常将 px*globalScale 再映射到 ppt 布局宽度（已在上层计算 globalScale）。保持不变。\r\n  const x = ((rect.left - pageRect.left) / pageTransformScale) * globalScale;\r\n  const y = ((rect.top - pageRect.top) / pageTransformScale) * globalScale;\r\n  const w = (rect.width / pageTransformScale) * globalScale;\r\n  const h = (rect.height / pageTransformScale) * globalScale;\r\n\r\n  // 字体大小：px -> pt（仅单位转换，1px ≈ 0.75pt）\r\n  const pxFontSize = parseFloat(style.fontSize) || 14;\r\n  const fontSize = pxFontSize * globalScale * 72;\r\n\r\n  // 字体\r\n  const fontFace = style.fontFamily?.split(\",\")[0].replace(/['\"]/g, \"\");\r\n\r\n  // 颜色\r\n  const color = colorToHex(style.color);\r\n\r\n  // 对齐\r\n  const align = ((): PptxGenJS.HAlign | undefined => {\r\n    switch (style.textAlign) {\r\n      case \"left\":\r\n      case \"start\":\r\n        return \"left\";\r\n      case \"center\":\r\n        return \"center\";\r\n      case \"right\":\r\n      case \"end\":\r\n        return \"right\";\r\n      case \"justify\":\r\n        return \"justify\";\r\n      default:\r\n        return undefined;\r\n    }\r\n  })();\r\n\r\n  const valign = ((): PptxGenJS.VAlign | undefined => {\r\n    switch (style.verticalAlign) {\r\n      case \"top\":\r\n        return \"top\";\r\n      case \"middle\":\r\n      case \"center\":\r\n        return \"middle\";\r\n      case \"bottom\":\r\n        return \"bottom\";\r\n      // [修改] CSS 默认是基线对齐或顶端对齐，PPT 默认是居中。强制默认为 top 以对齐浏览器视觉\r\n      default:\r\n        return \"top\";\r\n    }\r\n  })();\r\n\r\n  // 行高：CSS -> pt\r\n  let lineSpacing: number | undefined;\r\n  const lh = style.lineHeight;\r\n  if (lh === \"normal\" || !lh) {\r\n    lineSpacing = fontSize * 1.2; // 默认约为 1.2 倍字体大小\r\n  } else if (/^\\d+(\\.\\d+)?$/.test(lh)) {\r\n    // 数字倍数\r\n    lineSpacing = fontSize * parseFloat(lh);\r\n  } else {\r\n    // px 或其它单位，粗略按 px -> pt\r\n    const pxLineHeight = parseFloat(lh);\r\n    if (!isNaN(pxLineHeight)) {\r\n      lineSpacing = pxLineHeight * 0.75;\r\n    }\r\n  }\r\n  // 字间距（letter-spacing）px->pt\r\n  let charSpacing: number | undefined;\r\n  const ls = style.letterSpacing;\r\n  if (ls && ls !== \"normal\") {\r\n    const pxLs = parseFloat(ls);\r\n    if (!isNaN(pxLs)) {\r\n      charSpacing = pxLs * 0.75;\r\n    }\r\n  }\r\n\r\n  // 解析旋转角度\r\n  let rotate: number | undefined;\r\n  if (style.transform && style.transform !== \"none\") {\r\n    // transform: matrix(a, b, c, d, tx, ty)\r\n    const values = style.transform.split(\"(\")[1]?.split(\")\")[0].split(\",\");\r\n    if (values && values.length >= 4) {\r\n      const a = parseFloat(values[0]);\r\n      const b = parseFloat(values[1]);\r\n      // 计算角度 (弧度转角度)\r\n      const angle = Math.round(Math.atan2(b, a) * (180 / Math.PI));\r\n      if (angle !== 0) rotate = angle;\r\n    }\r\n  }\r\n\r\n  // --- Opacity 解析 ---\r\n  const cssOpacity = style.opacity || \"1\";\r\n  const opacityVal = parseFloat(cssOpacity); // 0-1\r\n  // 背景填充\r\n  const bgColor = colorToHex(style.backgroundColor);\r\n  const fill =\r\n    bgColor && bgColor !== \"\"\r\n      ? {\r\n          color: bgColor,\r\n          transparency: getMixedTransparency(style.backgroundColor, cssOpacity),\r\n        }\r\n      : undefined;\r\n\r\n  // 边框（统一采用 px->pt，不叠加 globalScale，避免双重缩放）\r\n  let border: ElementStyle[\"border\"];\r\n  const borderWidth = parseFloat(style.borderWidth);\r\n  if (borderWidth > 0 && style.borderStyle !== \"none\" && style.borderColor) {\r\n    border = {\r\n      pt: borderWidth * 0.75,\r\n      color: colorToHex(style.borderColor),\r\n      type: style.borderStyle === \"dashed\" ? \"dash\" : \"solid\",\r\n    };\r\n  }\r\n  // --- 圆角 (Border Radius) ---\r\n  const borderRadiusRaw = style.borderRadius || \"0px\";\r\n  const radiusPx = parseFloat(borderRadiusRaw);\r\n  const minSide = Math.min(rect.width, rect.height);\r\n  // 默认形状\r\n  let shapeType: \"rect\" | \"roundRect\" | \"ellipse\" = \"rect\";\r\n  let rectRadius: number | undefined = undefined;\r\n  if (radiusPx > 0 && minSide > 0) {\r\n    // 1. 判断是否为“完全圆形”\r\n    const isSquare = Math.abs(rect.width - rect.height) < 1.5;\r\n    const isFullRound = radiusPx >= minSide / 2 - 0.5; // 允许0.5px误差\r\n    if (isSquare && isFullRound) {\r\n      shapeType = \"ellipse\";\r\n      rectRadius = undefined; // 椭圆不需要圆角参数\r\n    } else {\r\n      shapeType = \"roundRect\";\r\n      // 精确计算比例：CSS像素 / 元素短边\r\n      let ratio = radiusPx / 130;\r\n      // ratio = 0.1;\r\n      if (ratio > 0.5) ratio = 0.5;\r\n      rectRadius = ratio;\r\n\r\n      // console.log(\"Computed borderRadius:\", borderRadiusRaw, \"->\", rectRadius);\r\n    }\r\n  }\r\n\r\n  // 文本样式\r\n  const bold = parseInt(style.fontWeight || \"400\", 10) >= 600 || style.fontWeight === \"bold\";\r\n  const italic = style.fontStyle === \"italic\";\r\n  const underline = style.textDecoration.includes(\"underline\");\r\n  const strike = style.textDecoration.includes(\"line-through\");\r\n\r\n  // 内边距（用于表格单元格等）\r\n  let padding: ElementStyle[\"padding\"];\r\n  const pt = (v: string) => (parseFloat(v || \"0\") || 0) * 0.75;\r\n  const ptTop = pt(style.paddingTop);\r\n  const ptRight = pt(style.paddingRight);\r\n  const ptBottom = pt(style.paddingBottom);\r\n  const ptLeft = pt(style.paddingLeft);\r\n  if (ptTop || ptRight || ptBottom || ptLeft) {\r\n    padding = [ptTop, ptRight, ptBottom, ptLeft];\r\n  }\r\n\r\n  return {\r\n    x,\r\n    y,\r\n    w,\r\n    h,\r\n    fontSize,\r\n    fontFace,\r\n    color,\r\n    align,\r\n    valign,\r\n    lineSpacing,\r\n    charSpacing,\r\n    fill,\r\n    border,\r\n    bold,\r\n    italic,\r\n    underline,\r\n    strike,\r\n    padding,\r\n    shapeType,\r\n    rectRadius,\r\n    opacity: opacityVal,\r\n    rotate,\r\n  };\r\n}\r\n","// animationTransform.ts\r\n\r\nimport PptxGenJS from \"pptxgenjs\";\r\n\r\nexport interface AnimationConfig {\r\n  type: string;\r\n  duration?: number;\r\n  delay?: number;\r\n}\r\n\r\n// 映射常见 CSS 动画名到 pptxgenjs 动画类型\r\nconst ANIMATION_MAP: Record<string, string> = {\r\n  fadeIn: \"fadeIn\",\r\n  fadeInUp: \"flyInBottom\",\r\n  fadeInDown: \"flyInTop\",\r\n  fadeInLeft: \"flyInLeft\",\r\n  fadeInRight: \"flyInRight\",\r\n  zoomIn: \"zoomIn\",\r\n  bounceIn: \"bounce\",\r\n  // 常见 slide/animate.css 命名\r\n  slideInUp: \"flyInBottom\",\r\n  slideInDown: \"flyInTop\",\r\n  slideInLeft: \"flyInLeft\",\r\n  slideInRight: \"flyInRight\",\r\n};\r\n\r\n/**\r\n * 获取元素动画配置\r\n * 优先 data-pptx-animation，其次 CSS animationName 映射\r\n */\r\nexport function getElementAnimation(element: Element): AnimationConfig | undefined {\r\n  const style = window.getComputedStyle(element);\r\n\r\n  // 显式 data 属性优先\r\n  const dataAnim = element.getAttribute(\"data-pptx-animation\");\r\n  if (dataAnim) {\r\n    const duration = parseInt(element.getAttribute(\"data-pptx-duration\") || \"1000\", 10) / 1000;\r\n    const delay = parseInt(element.getAttribute(\"data-pptx-delay\") || \"0\", 10) / 1000;\r\n    return { type: dataAnim, duration, delay };\r\n  }\r\n\r\n  // CSS 动画解析（取第一个）\r\n  const animName = style.animationName;\r\n  if (animName && animName !== \"none\") {\r\n    const primaryAnim = animName.split(\",\")[0].trim();\r\n\r\n    let pptAnimType = ANIMATION_MAP[primaryAnim];\r\n\r\n    // 模糊匹配，如 animate__fadeIn\r\n    if (!pptAnimType) {\r\n      const key = Object.keys(ANIMATION_MAP).find((k) => primaryAnim.toLowerCase().includes(k.toLowerCase()));\r\n      if (key) pptAnimType = ANIMATION_MAP[key];\r\n    }\r\n\r\n    if (pptAnimType) {\r\n      const durationStr = style.animationDuration.split(\",\")[0] ?? \"1s\";\r\n      const delayStr = style.animationDelay.split(\",\")[0] ?? \"0s\";\r\n      const parseTime = (t: string) => {\r\n        const val = parseFloat(t);\r\n        return t.includes(\"ms\") ? val / 1000 : val;\r\n      };\r\n\r\n      return {\r\n        type: pptAnimType,\r\n        duration: parseTime(durationStr) || 1,\r\n        delay: parseTime(delayStr) || 0,\r\n      };\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n}\r\n","import PptxGenJS from \"pptxgenjs\";\nimport { getComputedElementStyle, colorToHex } from \"./styleTransform\";\nimport { getElementAnimation } from \"./animationTransform\";\n\nconst PPT_LAYOUT = {\n  width: 10,\n  height: 5.625,\n};\n\ninterface ParsedTextShape {\n  text: string;\n  options: PptxGenJS.TextPropsOptions;\n}\n\ninterface ParseResult {\n  shapes: ParsedTextShape[]; // 以前是 textItems，现在改为 shapes\n  consumedElements: Set<Element>;\n}\n\n// 新增：图表配置接口，对应 pptxgenjs 的 addChart 参数\ninterface PptChartConfig {\n  type: any;\n  data: PptxGenJS.OptsChartData[];\n  options?: PptxGenJS.IChartOpts;\n}\n\n/**\n * 辅助函数：生成模拟间距的空格字符串\n */\nfunction getSpaceString(widthPx: number, fontSizePx: number): string {\n  if (widthPx <= 0) return \"\";\n  const spaceWidth = fontSizePx / 3;\n  const count = Math.round(widthPx / spaceWidth);\n  return \" \".repeat(count);\n}\n\n/**\n * 解析富文本 - 独立坐标模式\n * 不再聚合文本，而是计算每个 TextNode 的真实屏幕位置\n */\nfunction parseRichText(\n  rootElement: Element,\n  pageRect: DOMRect, // 需要传入页面容器的 rect 用于计算相对坐标\n  globalScale: number,\n  pageTransformScale: number\n): ParseResult {\n  const shapes: ParsedTextShape[] = [];\n  const consumedElements = new Set<Element>();\n\n  function traverse(node: Node, parentStyle: CSSStyleDeclaration) {\n    // 1. 处理文本节点\n    if (node.nodeType === Node.TEXT_NODE) {\n      const textContent = node.textContent || \"\";\n      if (!textContent.trim()) return;\n\n      const range = document.createRange();\n      range.selectNode(node);\n      const rect = range.getBoundingClientRect();\n\n      if (rect.width === 0 || rect.height === 0) return;\n\n      // --- 坐标计算 (逻辑同 getComputedElementStyle) ---\n      // 计算相对于 PPT 页面的坐标\n      const x = ((rect.left - pageRect.left) / pageTransformScale) * globalScale;\n      const y = ((rect.top - pageRect.top) / pageTransformScale) * globalScale;\n\n      // 宽度缓冲：为了防止 PPT 换行，稍微给宽一点点 (例如 + 2px 对应的 ppt单位)\n      // 也可以选择不加缓冲，但 PPT 渲染引擎通常比浏览器占宽\n      const w = (rect.width / pageTransformScale) * globalScale + 0.05;\n      const h = (rect.height / pageTransformScale) * globalScale;\n\n      // --- 样式计算 ---\n      const pxSize = parseFloat(parentStyle.fontSize || \"14\");\n      const ptSize = pxSize * globalScale * 72;\n      const bgColor = colorToHex(parentStyle.backgroundColor);\n\n      // 将该文本节点作为一个独立的文本框对象存入\n      shapes.push({\n        text: textContent,\n        options: {\n          x,\n          y,\n          w,\n          h,\n          fontSize: ptSize,\n          color: colorToHex(parentStyle.color),\n          fontFace: parentStyle.fontFamily?.split(\",\")[0].replace(/['\"]/g, \"\"),\n          bold: parseInt(parentStyle.fontWeight) >= 600 || parentStyle.fontWeight === \"bold\",\n          italic: parentStyle.fontStyle === \"italic\",\n          underline: parentStyle.textDecoration.includes(\"underline\") ? { style: \"sng\" } : undefined,\n          strike: parentStyle.textDecoration.includes(\"line-through\"),\n          highlight: bgColor ? bgColor : undefined,\n          subscript: parentStyle.verticalAlign === \"sub\",\n          superscript: parentStyle.verticalAlign === \"super\",\n          align: \"left\", // 强制左对齐，因为 x 坐标已经是文本的起点了\n          valign: \"top\", // 强制顶对齐\n          autoFit: false,\n          wrap: true, // 允许换行，防止溢出，但通常 rect 已经是一行的宽度了\n          inset: 0, // 去除内边距，保证位置精准\n        },\n      });\n    }\n    // 2. 处理元素节点\n    else if (node.nodeType === Node.ELEMENT_NODE) {\n      const el = node as Element;\n\n      const stopTags = [\"TABLE\", \"IMG\", \"CANVAS\", \"SVG\", \"VIDEO\", \"IFRAME\"];\n      if (stopTags.includes(el.tagName)) {\n        // 直接 return，不加入 consumedElements。\n        // 这样 processElement 的递归循环 (Array.from(element.children))\n        // 依然会遍历到这个节点，并调用专门的 addTable/addImage 逻辑。\n        return;\n      }\n      const style = window.getComputedStyle(el);\n      if (el.tagName === \"BR\") {\n        // BR 标签在独立坐标模式下通常不需要处理，\n        // 因为下一个文本节点的 Range rect 会自动出现在下一行\n        consumedElements.add(el);\n        return;\n      }\n\n      // 布局边界检查 (同上一次修改)\n      const isBlock = style.display === \"block\" || style.display === \"flex\" || style.display === \"grid\" || style.display === \"inline-block\" || style.position === \"absolute\" || style.position === \"fixed\";\n\n      const isStyleTag = [\"SPAN\", \"B\", \"STRONG\", \"I\", \"EM\", \"U\", \"FONT\", \"SUB\", \"SUP\", \"A\", \"SMALL\", \"BIG\"].includes(el.tagName);\n\n      // 如果是块级元素且不是样式标签，跳过，留给 processElement\n      if (isBlock && !isStyleTag) {\n        return;\n      }\n\n      if (style.display === \"none\" || style.visibility === \"hidden\" || style.opacity === \"0\") {\n        consumedElements.add(el);\n        return;\n      }\n\n      consumedElements.add(el);\n      el.childNodes.forEach((child) => traverse(child, style));\n    }\n  }\n\n  const rootStyle = window.getComputedStyle(rootElement);\n  rootElement.childNodes.forEach((child) => traverse(child, rootStyle));\n\n  return { shapes, consumedElements };\n}\n/**\n * 处理单个元素\n */\nfunction processElement(element: Element, slide: PptxGenJS.Slide | any, pageRect: DOMRect, globalScale: number, pageTransformScale: number) {\n  if (element.getAttribute(\"hidden\") !== null) return;\n  const style = window.getComputedStyle(element);\n  if (style.display === \"none\" || style.visibility === \"hidden\" || style.opacity === \"0\") return;\n  const pptStyle = getComputedElementStyle(element, pageRect, globalScale, pageTransformScale);\n  const animation = getElementAnimation(element);\n\n  // ============================================================\n  // --- 0. 优先处理原生图表 (Native Chart) ---\n  // 检查是否存在 data-pptx-chart-config 属性\n  // ============================================================\n  const chartConfigStr = element.getAttribute(\"data-pptx-chart-config\");\n  if (chartConfigStr) {\n    try {\n      // 解析配置\n      const chartConfig: PptChartConfig = JSON.parse(chartConfigStr);\n\n      // 合并样式：DOM 的位置 + JSON 中的配置\n      // JSON 中的 options 优先级更高，允许用户覆盖自动计算的 x,y,w,h\n      const finalOptions: PptxGenJS.IChartOpts = {\n        x: pptStyle.x,\n        y: pptStyle.y,\n        w: pptStyle.w,\n        h: pptStyle.h,\n        ...chartConfig.options,\n      };\n\n      // 添加原生图表\n      slide.addChart(chartConfig.type, chartConfig.data, finalOptions);\n\n      // 如果成功处理了图表，直接返回，不再作为图片或文本处理\n      return;\n    } catch (e) {\n      console.warn(\"解析图表配置失败，将回退到截图模式:\", e);\n      // 解析失败不 return，继续往下走，尝试作为 Canvas/Image 截图处理\n    }\n  }\n\n  // --- 1. 处理图片 ---\n  if (element.tagName === \"IMG\") {\n    const imgEl = element as HTMLImageElement;\n    if (imgEl.src) {\n      slide.addImage({\n        path: imgEl.src,\n        x: pptStyle.x,\n        y: pptStyle.y,\n        w: pptStyle.w,\n        h: pptStyle.h,\n        sizing: { type: \"contain\", w: pptStyle.w, h: pptStyle.h },\n        ...(animation ? { animate: { type: animation.type, duration: animation.duration } } : {}),\n      });\n    }\n    return;\n  }\n\n  // --- 2. 处理 Canvas (图表的回退方案) ---\n  if (element.tagName === \"CANVAS\") {\n    try {\n      const canvas = element as HTMLCanvasElement;\n      // 增加判断：如果是空 canvas 或者 tainted canvas 可能会报错\n      const imgData = canvas.toDataURL(\"image/png\");\n      slide.addImage({\n        data: imgData,\n        x: pptStyle.x,\n        y: pptStyle.y,\n        w: pptStyle.w,\n        h: pptStyle.h,\n        ...(animation ? { animate: { type: animation.type, duration: animation.duration } } : {}),\n      });\n    } catch (e) {\n      console.warn(\"Canvas export failed\", e);\n    }\n    return;\n  }\n\n  // --- 3. 处理表格 ---\n  if (element.tagName === \"TABLE\") {\n    // ... (保持原有的 Table 处理逻辑不变) ...\n    const tableElement = element as HTMLTableElement;\n    const rows = Array.from(tableElement.querySelectorAll(\"tr\"));\n    if (rows.length === 0) return;\n\n    const colWidthsPx: number[] = [];\n    let maxCols = 0;\n    rows.forEach((row) => {\n      let currentCols = 0;\n      Array.from(row.children).forEach((cell) => {\n        currentCols += parseInt(cell.getAttribute(\"colspan\") || \"1\");\n      });\n      if (currentCols > maxCols) maxCols = currentCols;\n    });\n\n    for (let i = 0; i < maxCols; i++) colWidthsPx.push(0);\n\n    rows.forEach((row) => {\n      let currentColIdx = 0;\n      Array.from(row.children).forEach((cell) => {\n        const cellRect = cell.getBoundingClientRect();\n        const colSpan = parseInt(cell.getAttribute(\"colspan\") || \"1\");\n        const cellPxWidth = cellRect.width;\n        const avgColWidth = cellPxWidth / colSpan;\n        for (let i = 0; i < colSpan; i++) {\n          if (colWidthsPx[currentColIdx + i] === 0 || avgColWidth > colWidthsPx[currentColIdx + i]) {\n            colWidthsPx[currentColIdx + i] = avgColWidth;\n          }\n        }\n        currentColIdx += colSpan;\n      });\n    });\n\n    const colW: number[] = colWidthsPx.map((px) => (px / pageTransformScale) * globalScale);\n\n    const totalPptColWidth = colW.reduce((sum, val) => sum + val, 0);\n    if (totalPptColWidth > 0 && Math.abs(totalPptColWidth - pptStyle.w) > 0.01) {\n      const scaleFactor = pptStyle.w / totalPptColWidth;\n      for (let i = 0; i < colW.length; i++) colW[i] *= scaleFactor;\n    } else if (colW.length === 0 && rows.length > 0) {\n      colW.push(...Array(maxCols > 0 ? maxCols : 1).fill(pptStyle.w / (maxCols > 0 ? maxCols : 1)));\n    }\n\n    const rowH: number[] = [];\n    rows.forEach((row) => {\n      const rowRect = row.getBoundingClientRect();\n      rowH.push((rowRect.height / pageTransformScale) * globalScale);\n    });\n\n    const tableData: PptxGenJS.TableRow[] = [];\n    rows.forEach((row) => {\n      const rowData: PptxGenJS.TableCell[] | any = [];\n      const cells = Array.from(row.querySelectorAll(\"td, th\"));\n\n      cells.forEach((cell) => {\n        const cellStyle = getComputedElementStyle(cell, pageRect, globalScale, pageTransformScale);\n        const cellTxt = cell.textContent || \"\";\n\n        rowData.push({\n          text: cellTxt,\n          options: {\n            fill: cellStyle.fill,\n            color: cellStyle.color,\n            bold: cellStyle.bold,\n            italic: cellStyle.italic,\n            underline: cellStyle.underline,\n            strike: cellStyle.strike,\n            align: cellStyle.align,\n            valign: cellStyle.valign,\n            margin: cellStyle.padding,\n            border: cellStyle.border\n              ? {\n                  pt: cellStyle.border.pt,\n                  color: cellStyle.border.color,\n                  type: cellStyle.border.type as any,\n                }\n              : undefined,\n            rowspan: parseInt(cell.getAttribute(\"rowspan\") || \"1\"),\n            colspan: parseInt(cell.getAttribute(\"colspan\") || \"1\"),\n            fontSize: cellStyle.fontSize,\n            fontFace: cellStyle.fontFace,\n            lineSpacing: cellStyle.lineSpacing,\n            charSpacing: cellStyle.charSpacing,\n            wrap: true,\n            autoFit: false,\n          },\n        });\n      });\n      if (rowData.length) tableData.push(rowData);\n    });\n\n    if (tableData.length) {\n      slide.addTable(tableData, {\n        x: pptStyle.x,\n        y: pptStyle.y,\n        w: pptStyle.w,\n        colW: colW.length > 0 ? colW : undefined,\n        rowH: rowH.length > 0 ? rowH : undefined,\n        fill: pptStyle.fill,\n        line: pptStyle.border,\n      });\n    }\n    return;\n  }\n  // --- 4. 预先计算文本 (先不画，只计算) ---\n  const { shapes, consumedElements } = parseRichText(element, pageRect, globalScale, pageTransformScale);\n\n  // --- 5. 普通容器 (背景/边框/动画) ---\n  const hasBackground = pptStyle.fill && pptStyle.fill.color;\n  const hasBorder = pptStyle.border;\n  if (hasBackground || hasBorder || (shapes.length === 0 && ![\"SPAN\", \"B\", \"I\", \"U\", \"STRONG\", \"EM\"].includes(element.tagName))) {\n    slide.addShape(pptStyle.shapeType, {\n      x: pptStyle.x,\n      y: pptStyle.y,\n      w: pptStyle.w,\n      h: pptStyle.h,\n      fill: pptStyle.fill,\n      line: pptStyle.border,\n      rectRadius: pptStyle.rectRadius,\n      rotate: pptStyle.rotate,\n      ...(animation ? { animate: { type: animation.type, duration: animation.duration } } : {}),\n    });\n  }\n  // --- 6. 绘制文本 ---\n  if (shapes.length > 0) {\n    shapes.forEach((shape) => {\n      slide.addText(shape.text, {\n        ...shape.options,\n        // 继承父级动画\n        ...(animation ? { animate: { type: animation.type, duration: animation.duration } } : {}),\n        // 继承父级旋转\n        rotate: pptStyle.rotate,\n      });\n    });\n  }\n\n  // --- 递归处理子元素 ---\n  Array.from(element.children).forEach((child) => {\n    if (consumedElements.has(child)) return;\n    processElement(child, slide, pageRect, globalScale, pageTransformScale);\n  });\n}\n\n/**\n * 将 html dom 转换为 pptx 对象\n */\nexport function html2pptx(pageClass: string): PptxGenJS {\n  const ppt = new PptxGenJS();\n  ppt.layout = \"LAYOUT_16x9\";\n  ppt.theme = { headFontFace: \"黑体\" };\n  const pages = document.querySelectorAll(`.${pageClass}`);\n\n  if (pages.length === 0) {\n    console.warn(`[html2pptx] 未找到类名为 .${pageClass} 的幻灯片元素`);\n    return ppt;\n  }\n\n  pages.forEach((dom) => {\n    const element = dom as HTMLElement;\n    if (element.offsetWidth === 0 || element.offsetHeight === 0) return;\n\n    const pageRect = element.getBoundingClientRect();\n    const pageTransformScale = pageRect.width / element.offsetWidth;\n\n    if (pageTransformScale === 0) return;\n\n    const unscaledPageWidth = element.offsetWidth;\n    const globalScale = PPT_LAYOUT.width / unscaledPageWidth;\n\n    const slide = ppt.addSlide();\n\n    const bgStyle = window.getComputedStyle(element);\n    const bgImg = bgStyle.backgroundImage;\n    const bgColor = colorToHex(bgStyle.backgroundColor);\n    if (bgImg && bgImg.includes(\"url(\")) {\n      const match = bgImg.match(/url\\s*\\(['\"]?(.*?)['\"]?\\)/);\n      const imageUrl = match && match[1] ? match[1] : undefined;\n      slide.addImage({ x: 0, y: 0, w: \"100%\", h: \"100%\", path: imageUrl });\n    } else if (bgColor) {\n      // 处理纯色 (如果背景是渐变，通常 computedStyle 的 backgroundColor 会是透明或回退色，这里只取 color)\n      slide.background = { color: bgColor };\n    }\n    // console.log(\"page:\", slide);\n    Array.from(element.children).forEach((child) => {\n      processElement(child, slide, pageRect, globalScale, pageTransformScale);\n    });\n  });\n\n  return ppt;\n}\n\n/**\n * 从 URL 获取图片并将其编码为 Base64 Data URI。\n * @param url 图片的 URL\n * @returns Base64 编码的图片字符串，如果失败则返回 null。\n */\nasync function fetchAndEncodeImageToBase64(url: string): Promise<string | null> {\n  try {\n    const response = await fetch(url, { mode: \"cors\" }); // 尝试使用 cors 模式\n    if (!response.ok) {\n      console.error(`Failed to fetch image from ${url}: ${response.statusText}`);\n      return null;\n    }\n    const blob = await response.blob(); // 获取图片 Blob 数据\n\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => resolve(reader.result as string);\n      reader.onerror = reject;\n      reader.readAsDataURL(blob); // 将 Blob 转换为 Data URL (Base64)\n    });\n  } catch (error) {\n    console.error(`Error fetching or encoding image from ${url}:`, error);\n    return null;\n  }\n}\n","import { html2pptx } from \"./analyze\";\n\nexport type WRITE_OUTPUT_TYPE = \"arraybuffer\" | \"base64\" | \"binarystring\" | \"blob\" | \"nodebuffer\" | \"uint8array\" | \"STREAM\";\n\nexport function exportHtmlToPpt(pageClassName: string = \"page\", outputType: WRITE_OUTPUT_TYPE = \"blob\"): Promise<string | ArrayBuffer | Blob | Uint8Array> {\n  return new Promise(async (resolve, reject) => {\n    try {\n      const PptxGenJSIns = await html2pptx(pageClassName);\n      const result = PptxGenJSIns.write({ outputType });\n      resolve(result);\n    } catch (error) {\n      console.error(\"PPT Generation Error:\", error);\n      reject(error);\n    }\n  });\n}\n\nexport function downloadHtmlToPpt(pageClassName: string = \"page\", fileName: string = \"presentation\"): Promise<void> {\n  return new Promise(async (resolve, reject) => {\n    try {\n      // 使用 writeFile 自动触发浏览器下载\n      const PptxGenJSIns = await html2pptx(pageClassName);\n      PptxGenJSIns.writeFile({ fileName: fileName + \".pptx\" });\n      resolve();\n    } catch (error) {\n      console.error(\"PPT Generation Error:\", error);\n      reject(error);\n    }\n  });\n}\n"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","_","label","sent","trys","ops","g","create","Iterator","verb","Symbol","iterator","v","op","TypeError","pop","push","colorToHex","color","startsWith","replace","toUpperCase","rgba","match","parseFloat","parseInt","toString","padStart","getMixedTransparency","colorStr","cssOpacity","alpha","elementOpacity","isNaN","Math","round","getComputedElementStyle","element","pageRect","globalScale","pageTransformScale","lineSpacing","charSpacing","style","window","getComputedStyle","rect","getBoundingClientRect","x","left","top","w","width","h","height","fontSize","fontFace","_a","fontFamily","split","align","textAlign","valign","verticalAlign","lh","lineHeight","test","pxLineHeight","rotate","ls","letterSpacing","pxLs","transform","values","_b","a","b","angle","atan2","PI","border","opacity","opacityVal","bgColor","backgroundColor","fill","transparency","undefined","borderWidth","borderStyle","borderColor","pt","type","borderRadiusRaw","borderRadius","radiusPx","minSide","min","shapeType","rectRadius","abs","ratio","padding","bold","fontWeight","italic","fontStyle","underline","textDecoration","includes","strike","ptTop","paddingTop","ptRight","paddingRight","ptBottom","paddingBottom","ptLeft","paddingLeft","SuppressedError","ANIMATION_MAP","fadeIn","fadeInUp","fadeInDown","fadeInLeft","fadeInRight","zoomIn","bounceIn","slideInUp","slideInDown","slideInLeft","slideInRight","PPT_LAYOUT","parseRichText","rootElement","shapes","consumedElements","Set","traverse","node","parentStyle","nodeType","Node","TEXT_NODE","textContent","trim","range","document","createRange","selectNode","ptSize","text","options","highlight","subscript","superscript","autoFit","wrap","inset","ELEMENT_NODE","el","tagName","style_1","add","isBlock","display","position","isStyleTag","visibility","childNodes","forEach","child","rootStyle","processElement","slide","getAttribute","pptStyle","animation","dataAnim","duration","delay","animName","animationName","primaryAnim_1","pptAnimType","key","keys","find","k","toLowerCase","durationStr","animationDuration","delayStr","animationDelay","parseTime","val","getElementAnimation","chartConfigStr","chartConfig","JSON","parse","finalOptions","addChart","data","console","warn","tableElement","rows","Array","from","querySelectorAll","colWidthsPx_1","maxCols_1","row","currentCols","children","cell","currentColIdx","cellRect","colSpan","avgColWidth","colW","map","px","totalPptColWidth","reduce","sum","scaleFactor","rowH_1","rowRect","tableData_1","rowData","cellStyle","cellTxt","margin","rowspan","colspan","addTable","rowH","line","hasBackground","hasBorder","addShape","animate","shape","addText","has","imgData","toDataURL","addImage","imgEl","src","path","sizing","html2pptx","pageClass","ppt","PptxGenJS","layout","theme","headFontFace","pages","concat","dom","offsetWidth","offsetHeight","unscaledPageWidth","addSlide","bgStyle","bgImg","backgroundImage","imageUrl","background","pageClassName","fileName","_this","writeFile","error","error_2","outputType","PptxGenJSIns","write","error_1"],"mappings":"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"}