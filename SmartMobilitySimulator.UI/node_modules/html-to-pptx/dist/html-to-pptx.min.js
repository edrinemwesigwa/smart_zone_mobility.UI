!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("pptxgenjs")):"function"==typeof define&&define.amd?define(["exports","pptxgenjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).HtmlToPptx={},t.PptxGenJS)}(this,(function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=r(e),o=function(){return o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},o.apply(this,arguments)};function a(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{d(n.next(t))}catch(t){a(t)}}function l(t){try{d(n.throw(t))}catch(t){a(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,l)}d((n=n.apply(t,e||[])).next())}))}function i(t,e){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(d){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,n=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=e.call(t,a)}catch(t){l=[6,t],n=0}finally{r=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,d])}}}function l(t){if(!t||"transparent"===t||"inherit"===t)return"";if(t.startsWith("#"))return t.replace("#","").toUpperCase();if(t.startsWith("rgb")){var e=t.match(/(\d+(\.\d+)?)/g);if(e&&e.length>=3)return e.length>3&&0===parseFloat(e[3])?"":(parseInt(e[0],10).toString(16).padStart(2,"0")+parseInt(e[1],10).toString(16).padStart(2,"0")+parseInt(e[2],10).toString(16).padStart(2,"0")).toUpperCase()}return"000000"}function d(t,e){var r=1,n=parseFloat(e);if(isNaN(n)||(r*=n),t&&t.startsWith("rgba")){var o=t.match(/(\d+(\.\d+)?)/g);if(o&&o.length>=4)r*=parseFloat(o[3])}if(!(r>=1))return Math.round(100*(1-r))}function c(t,e,r,n){var o,a,i,c,u=window.getComputedStyle(t),s=t.getBoundingClientRect(),f=(s.left-e.left)/n*r,p=(s.top-e.top)/n*r,h=s.width/n*r,g=s.height/n*r,y=(parseFloat(u.fontSize)||14)*r*72,v=null===(o=u.fontFamily)||void 0===o?void 0:o.split(",")[0].replace(/['"]/g,""),b=l(u.color),m=function(){switch(u.textAlign){case"left":case"start":return"left";case"center":return"center";case"right":case"end":return"right";case"justify":return"justify";default:return}}(),w=function(){switch(u.verticalAlign){case"top":default:return"top";case"middle":case"center":return"middle";case"bottom":return"bottom"}}(),S=u.lineHeight;if("normal"!==S&&S)if(/^\d+(\.\d+)?$/.test(S))i=y*parseFloat(S);else{var x=parseFloat(S);isNaN(x)||(i=.75*x)}else i=1.2*y;var I,A=u.letterSpacing;if(A&&"normal"!==A){var E=parseFloat(A);isNaN(E)||(c=.75*E)}if(u.transform&&"none"!==u.transform){var N=null===(a=u.transform.split("(")[1])||void 0===a?void 0:a.split(")")[0].split(",");if(N&&N.length>=4){var F=parseFloat(N[0]),C=parseFloat(N[1]),T=Math.round(Math.atan2(C,F)*(180/Math.PI));0!==T&&(I=T)}}var R,k=u.opacity||"1",P=parseFloat(k),B=l(u.backgroundColor),M=B&&""!==B?{color:B,transparency:d(u.backgroundColor,k)}:void 0,O=parseFloat(u.borderWidth);O>0&&"none"!==u.borderStyle&&u.borderColor&&(R={pt:.75*O,color:l(u.borderColor),type:"dashed"===u.borderStyle?"dash":"solid"});var L=u.borderRadius||"0px",j=parseFloat(L),D=Math.min(s.width,s.height),W="rect",G=void 0;if(j>0&&D>0)if(Math.abs(s.width-s.height)<1.5&&j>=D/2-.5)W="ellipse",G=void 0;else{W="roundRect";var U=j/130;U>.5&&(U=.5),G=U}var z,H=parseInt(u.fontWeight||"400",10)>=600||"bold"===u.fontWeight,_="italic"===u.fontStyle,q=u.textDecoration.includes("underline"),V=u.textDecoration.includes("line-through"),J=function(t){return.75*(parseFloat(t||"0")||0)},X=J(u.paddingTop),Y=J(u.paddingRight),$=J(u.paddingBottom),K=J(u.paddingLeft);return(X||Y||$||K)&&(z=[X,Y,$,K]),{x:f,y:p,w:h,h:g,fontSize:y,fontFace:v,color:b,align:m,valign:w,lineSpacing:i,charSpacing:c,fill:M,border:R,bold:H,italic:_,underline:q,strike:V,padding:z,shapeType:W,rectRadius:G,opacity:P,rotate:I}}"function"==typeof SuppressedError&&SuppressedError;var u={fadeIn:"fadeIn",fadeInUp:"flyInBottom",fadeInDown:"flyInTop",fadeInLeft:"flyInLeft",fadeInRight:"flyInRight",zoomIn:"zoomIn",bounceIn:"bounce",slideInUp:"flyInBottom",slideInDown:"flyInTop",slideInLeft:"flyInLeft",slideInRight:"flyInRight"};var s=10;function f(t,e,r,n){var o=[],a=new Set;function i(t,d){var c;if(t.nodeType===Node.TEXT_NODE){var u=t.textContent||"";if(!u.trim())return;var s=document.createRange();s.selectNode(t);var f=s.getBoundingClientRect();if(0===f.width||0===f.height)return;var p=(f.left-e.left)/n*r,h=(f.top-e.top)/n*r,g=f.width/n*r+.05,y=f.height/n*r,v=parseFloat(d.fontSize||"14")*r*72,b=l(d.backgroundColor);o.push({text:u,options:{x:p,y:h,w:g,h:y,fontSize:v,color:l(d.color),fontFace:null===(c=d.fontFamily)||void 0===c?void 0:c.split(",")[0].replace(/['"]/g,""),bold:parseInt(d.fontWeight)>=600||"bold"===d.fontWeight,italic:"italic"===d.fontStyle,underline:d.textDecoration.includes("underline")?{style:"sng"}:void 0,strike:d.textDecoration.includes("line-through"),highlight:b||void 0,subscript:"sub"===d.verticalAlign,superscript:"super"===d.verticalAlign,align:"left",valign:"top",autoFit:!1,wrap:!0,inset:0}})}else if(t.nodeType===Node.ELEMENT_NODE){var m=t;if(["TABLE","IMG","CANVAS","SVG","VIDEO","IFRAME"].includes(m.tagName))return;var w=window.getComputedStyle(m);if("BR"===m.tagName)return void a.add(m);var S="block"===w.display||"flex"===w.display||"grid"===w.display||"inline-block"===w.display||"absolute"===w.position||"fixed"===w.position,x=["SPAN","B","STRONG","I","EM","U","FONT","SUB","SUP","A","SMALL","BIG"].includes(m.tagName);if(S&&!x)return;if("none"===w.display||"hidden"===w.visibility||"0"===w.opacity)return void a.add(m);a.add(m),m.childNodes.forEach((function(t){return i(t,w)}))}}var d=window.getComputedStyle(t);return t.childNodes.forEach((function(t){return i(t,d)})),{shapes:o,consumedElements:a}}function p(t,e,r,n,a){if(null===t.getAttribute("hidden")){var i=window.getComputedStyle(t);if("none"!==i.display&&"hidden"!==i.visibility&&"0"!==i.opacity){var l=c(t,r,n,a),d=function(t){var e,r,n=window.getComputedStyle(t),o=t.getAttribute("data-pptx-animation");if(o)return{type:o,duration:parseInt(t.getAttribute("data-pptx-duration")||"1000",10)/1e3,delay:parseInt(t.getAttribute("data-pptx-delay")||"0",10)/1e3};var a=n.animationName;if(a&&"none"!==a){var i=a.split(",")[0].trim(),l=u[i];if(!l){var d=Object.keys(u).find((function(t){return i.toLowerCase().includes(t.toLowerCase())}));d&&(l=u[d])}if(l){var c=null!==(e=n.animationDuration.split(",")[0])&&void 0!==e?e:"1s",s=null!==(r=n.animationDelay.split(",")[0])&&void 0!==r?r:"0s",f=function(t){var e=parseFloat(t);return t.includes("ms")?e/1e3:e};return{type:l,duration:f(c)||1,delay:f(s)||0}}}}(t),s=t.getAttribute("data-pptx-chart-config");if(s)try{var h=JSON.parse(s),g=o({x:l.x,y:l.y,w:l.w,h:l.h},h.options);return void e.addChart(h.type,h.data,g)}catch(t){console.warn("解析图表配置失败，将回退到截图模式:",t)}if("IMG"!==t.tagName)if("CANVAS"!==t.tagName){if("TABLE"===t.tagName){var y=t,v=Array.from(y.querySelectorAll("tr"));if(0===v.length)return;var b=[],m=0;v.forEach((function(t){var e=0;Array.from(t.children).forEach((function(t){e+=parseInt(t.getAttribute("colspan")||"1")})),e>m&&(m=e)}));for(var w=0;w<m;w++)b.push(0);v.forEach((function(t){var e=0;Array.from(t.children).forEach((function(t){for(var r=t.getBoundingClientRect(),n=parseInt(t.getAttribute("colspan")||"1"),o=r.width/n,a=0;a<n;a++)(0===b[e+a]||o>b[e+a])&&(b[e+a]=o);e+=n}))}));var S=b.map((function(t){return t/a*n})),x=S.reduce((function(t,e){return t+e}),0);if(x>0&&Math.abs(x-l.w)>.01){var I=l.w/x;for(w=0;w<S.length;w++)S[w]*=I}else 0===S.length&&v.length>0&&S.push.apply(S,Array(m>0?m:1).fill(l.w/(m>0?m:1)));var A=[];v.forEach((function(t){var e=t.getBoundingClientRect();A.push(e.height/a*n)}));var E=[];return v.forEach((function(t){var e=[];Array.from(t.querySelectorAll("td, th")).forEach((function(t){var o=c(t,r,n,a),i=t.textContent||"";e.push({text:i,options:{fill:o.fill,color:o.color,bold:o.bold,italic:o.italic,underline:o.underline,strike:o.strike,align:o.align,valign:o.valign,margin:o.padding,border:o.border?{pt:o.border.pt,color:o.border.color,type:o.border.type}:void 0,rowspan:parseInt(t.getAttribute("rowspan")||"1"),colspan:parseInt(t.getAttribute("colspan")||"1"),fontSize:o.fontSize,fontFace:o.fontFace,lineSpacing:o.lineSpacing,charSpacing:o.charSpacing,wrap:!0,autoFit:!1}})})),e.length&&E.push(e)})),void(E.length&&e.addTable(E,{x:l.x,y:l.y,w:l.w,colW:S.length>0?S:void 0,rowH:A.length>0?A:void 0,fill:l.fill,line:l.border}))}var N=f(t,r,n,a),F=N.shapes,C=N.consumedElements,T=l.fill&&l.fill.color,R=l.border;(T||R||0===F.length&&!["SPAN","B","I","U","STRONG","EM"].includes(t.tagName))&&e.addShape(l.shapeType,o({x:l.x,y:l.y,w:l.w,h:l.h,fill:l.fill,line:l.border,rectRadius:l.rectRadius,rotate:l.rotate},d?{animate:{type:d.type,duration:d.duration}}:{})),F.length>0&&F.forEach((function(t){e.addText(t.text,o(o(o({},t.options),d?{animate:{type:d.type,duration:d.duration}}:{}),{rotate:l.rotate}))})),Array.from(t.children).forEach((function(t){C.has(t)||p(t,e,r,n,a)}))}else try{var k=t.toDataURL("image/png");e.addImage(o({data:k,x:l.x,y:l.y,w:l.w,h:l.h},d?{animate:{type:d.type,duration:d.duration}}:{}))}catch(t){console.warn("Canvas export failed",t)}else{var P=t;P.src&&e.addImage(o({path:P.src,x:l.x,y:l.y,w:l.w,h:l.h,sizing:{type:"contain",w:l.w,h:l.h}},d?{animate:{type:d.type,duration:d.duration}}:{}))}}}}function h(t){var e=new n.default;e.layout="LAYOUT_16x9",e.theme={headFontFace:"黑体"};var r=document.querySelectorAll(".".concat(t));return 0===r.length?(console.warn("[html2pptx] 未找到类名为 .".concat(t," 的幻灯片元素")),e):(r.forEach((function(t){var r=t;if(0!==r.offsetWidth&&0!==r.offsetHeight){var n=r.getBoundingClientRect(),o=n.width/r.offsetWidth;if(0!==o){var a=r.offsetWidth,i=s/a,d=e.addSlide(),c=window.getComputedStyle(r),u=c.backgroundImage,f=l(c.backgroundColor);if(u&&u.includes("url(")){var h=u.match(/url\s*\(['"]?(.*?)['"]?\)/),g=h&&h[1]?h[1]:void 0;d.addImage({x:0,y:0,w:"100%",h:"100%",path:g})}else f&&(d.background={color:f});Array.from(r.children).forEach((function(t){p(t,d,n,i,o)}))}}})),e)}t.downloadHtmlToPpt=function(t,e){var r=this;return void 0===t&&(t="page"),void 0===e&&(e="presentation"),new Promise((function(n,o){return a(r,void 0,void 0,(function(){var r;return i(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,h(t)];case 1:return a.sent().writeFile({fileName:e+".pptx"}),n(),[3,3];case 2:return r=a.sent(),console.error("PPT Generation Error:",r),o(r),[3,3];case 3:return[2]}}))}))}))},t.exportHtmlToPpt=function(t,e){var r=this;return void 0===t&&(t="page"),void 0===e&&(e="blob"),new Promise((function(n,o){return a(r,void 0,void 0,(function(){var r,a,l;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,h(t)];case 1:return r=i.sent(),a=r.write({outputType:e}),n(a),[3,3];case 2:return l=i.sent(),console.error("PPT Generation Error:",l),o(l),[3,3];case 3:return[2]}}))}))}))},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=html-to-pptx.min.js.map
