<div class="business-container">
  <div class="business-header">
    <h2>Business Case Calculator</h2>
    <p>Interactive financial model for UAE smart mobility pilots.</p>
  </div>

  <div class="business-grid">
    <div class="business-form">
      <label>Simulation</label>
      <select [(ngModel)]="selectedSimulationId" (change)="onInputsChanged()">
        <option value="">Select simulation</option>
        <option *ngFor="let sim of simulations" [value]="sim.id">
          {{ sim.name }} • AED {{ sim.estimatedRevenue | number }} / day
        </option>
      </select>

      <label>Pilot Cost (AED)</label>
      <input
        type="range"
        min="100000"
        max="500000"
        step="10000"
        [(ngModel)]="pilotCost"
        (input)="onInputsChanged()"
      />
      <div class="slider-value">AED {{ pilotCost | number }}</div>

      <label>Annual Growth Rate</label>
      <input
        type="range"
        min="5"
        max="15"
        step="1"
        [(ngModel)]="growthRate"
        (input)="onInputsChanged()"
      />
      <div class="slider-value">{{ growthRate }}%</div>

      <label>Discount Rate</label>
      <input
        type="range"
        min="8"
        max="12"
        step="0.5"
        [(ngModel)]="discountRate"
        (input)="onInputsChanged()"
      />
      <div class="slider-value">{{ discountRate }}%</div>

      <label>Projection Years</label>
      <select [(ngModel)]="years" (change)="onInputsChanged()">
        <option [value]="3">3 years</option>
        <option [value]="5">5 years</option>
        <option [value]="10">10 years</option>
      </select>

      <button class="btn-export" (click)="exportInvestmentMemo()">
        Export Investment Memo PDF
      </button>

      <div class="error" *ngIf="error">{{ error }}</div>
    </div>

    <div class="business-visuals">
      <div class="card">
        <h4>Cash Flow (Cumulative)</h4>
        <svg viewBox="0 0 320 140">
          <polyline
            [attr.points]="getCashFlowPoints()"
            fill="none"
            stroke="#2196F3"
            stroke-width="3"
          ></polyline>
        </svg>
      </div>

      <div class="card gauges">
        <div>
          <h4>NPV</h4>
          [style.width.%]="getTornadoWidth(bar.value)"
        </div>
        <div>
          <h4>IRR</h4>
          <div class="gauge">
            <div class="gauge-fill" [style.width]="getNPVGauge()"></div>
          </div>
          <p>{{ irr | number: "1.0-1" }}%</p>
        </div>
        <div>
          <h4>Payback</h4>
          <p *ngIf="paybackPeriod >= 0">Year {{ paybackPeriod }}</p>
          <p *ngIf="paybackPeriod < 0">Beyond horizon</p>
        </div>
      </div>

      <div class="card">
        <h4>Sensitivity Tornado</h4>
        <div class="tornado">
          <div class="tornado-row" *ngFor="let bar of getSensitivityBars()">
            <span>{{ bar.label }}</span>
            <div class="tornado-bar">
              <div
                class="fill"
                [style.width.%]="getTornadoWidth(bar.value)"
                [class.negative]="bar.value < 0"
              ></div>
            </div>
            <strong>{{ bar.value | number: "1.0-0" }}</strong>
          </div>
        </div>
      </div>

      <div class="card">
        <h4>UAE Government Metrics</h4>
        <div class="gov-metrics">
          <div>
            <span>SROI</span>
            <strong>{{ getSroiValue() | number: "1.2-2" }}x</strong>
          </div>
          <div>
            <span>CO₂ Value</span>
            <strong>AED {{ getCo2Value() | number: "1.0-0" }}</strong>
          </div>
          <div>
            <span>Productivity Gains</span>
            <strong
              >AED {{ getProductivityGainValue() | number: "1.0-0" }}</strong
            >
          </div>
          <div>
            <span>Healthcare Reduction</span>
            <strong
              >AED {{ getHealthcareReductionValue() | number: "1.0-0" }}</strong
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



